<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Node.js | Ananiu's BLOG</title><meta name="keywords" content="Node"><meta name="author" content="Ananiu"><meta name="copyright" content="Ananiu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. fs 文件系统1.1 fs 文件系统模块 fs 模块是 Node.js 官方提供的、用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求  fs.readFile() 方法，用来读取指定文件中的内容 fs.writeFile() 方法，用来向指定的文件中写入内容   如果要在 JavaScript 代码中，使用 fs 模块来操作文件，则需要使用如下的方式先导入它 1c">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js">
<meta property="og:url" content="https://ananiu.xyz/posts/nodejs.html/index.html">
<meta property="og:site_name" content="Ananiu&#39;s BLOG">
<meta property="og:description" content="1. fs 文件系统1.1 fs 文件系统模块 fs 模块是 Node.js 官方提供的、用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求  fs.readFile() 方法，用来读取指定文件中的内容 fs.writeFile() 方法，用来向指定的文件中写入内容   如果要在 JavaScript 代码中，使用 fs 模块来操作文件，则需要使用如下的方式先导入它 1c">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/12/10/PxUtYv75oglSq8D.jpg">
<meta property="article:published_time" content="2021-05-05T04:57:50.000Z">
<meta property="article:modified_time" content="2021-05-20T03:13:20.306Z">
<meta property="article:author" content="Ananiu">
<meta property="article:tag" content="Node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/12/10/PxUtYv75oglSq8D.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ananius/blog/userpic.png"><link rel="canonical" href="https://ananiu.xyz/posts/nodejs.html/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":249,"languages":{"author":"作者: Ananiu","link":"链接: ","source":"来源: Ananiu's BLOG","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-20 11:13:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ananius/blog/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome-animation@0.2.1/dist/font-awesome-animation.min.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/ananius/blog/userpic.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/love/"><i class="fa-fw fas fa-heart   faa-tada animated"></i><span> LOVE</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/12/10/PxUtYv75oglSq8D.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ananiu's BLOG</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/love/"><i class="fa-fw fas fa-heart   faa-tada animated"></i><span> LOVE</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Node.js</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-05T04:57:50.000Z" title="发表于 2021-05-05 12:57:50">2021-05-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-20T03:13:20.306Z" title="更新于 2021-05-20 11:13:20">2021-05-20</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="1-fs-文件系统"><a href="#1-fs-文件系统" class="headerlink" title="1. fs 文件系统"></a>1. <code>fs</code> 文件系统</h1><h2 id="1-1-fs-文件系统模块"><a href="#1-1-fs-文件系统模块" class="headerlink" title="1.1 fs 文件系统模块"></a>1.1 <code>fs</code> 文件系统模块</h2><ol>
<li><p><code>fs</code> 模块是 <code>Node.js</code> 官方提供的、用来<strong>操作文件</strong>的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求</p>
<ul>
<li><code>fs.readFile()</code> 方法，用来读取指定文件中的内容</li>
<li><code>fs.writeFile()</code> 方法，用来向指定的文件中写入内容</li>
</ul>
</li>
<li><p>如果要在 <code>JavaScript</code> 代码中，使用 <code>fs</code> 模块来操作文件，则需要使用如下的方式先导入它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1-2-读取指定文件中的内容-★"><a href="#1-2-读取指定文件中的内容-★" class="headerlink" title="1.2 读取指定文件中的内容 ★"></a>1.2 读取指定文件中的内容 ★</h2><ol>
<li> <code>fs.readFile()</code> 的语法格式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(path, [options], callback);</span><br></pre></td></tr></table></figure>

<p>参数解读：</p>
<pre><code>  1. 参数1：必选参数，字符串，表示文件的路径
  2. 参数2：可选参数，表示以什么编码格式来读取文件
  3. 参数3：必选参数，文件读取完成后，通过回调函数拿到读取的结果

  4. `fs.readFile()` 的示例代码
</code></pre>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 第一步，导入fs对象 */</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// console.log(fs);</span></span><br><span class="line"><span class="comment">/* 第二步，调用 fs.readFile() 方法读取文件的内容 */</span></span><br><span class="line">fs.readFile(<span class="string">&quot;./goudan.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//  参数 1： 读取文件的存放路径</span></span><br><span class="line">  <span class="comment">//  参数 2： 读取文件时候的编码格式，一般默认是 utf8</span></span><br><span class="line">  <span class="comment">//  参数 3： 回调函数，拿到读取失败和成功的结果， err 以及 data</span></span><br><span class="line">  <span class="comment">// 读取完毕会执行这个回调</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">        读取成功：err是null,data是文件内容</span></span><br><span class="line"><span class="comment">        读取失败：err是错误对象，data 是undefined</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="comment">// 判断文件是否读取成功</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件读取失败，错误信息为：&quot;</span> + err.message);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件读取成功，内容为：&quot;</span> + data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="1-3-向指定的文件中写入内容-★"><a href="#1-3-向指定的文件中写入内容-★" class="headerlink" title="1.3 向指定的文件中写入内容 ★"></a>1.3 向指定的文件中写入内容 ★</h2><ol>
<li><p><code>fs.writeFile()</code> 的语法格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(file, data, [options], callback);</span><br></pre></td></tr></table></figure>

<p>参数解读：</p>
<ol>
<li>参数 1：必选参数，需要指定一个文件路径的字符串，表示文件的存放路径</li>
<li>参数 2：必选参数，表示要写入的内容</li>
<li>参数 3：可选参数，表示以什么格式写入文件内容，默认值是 <code>utf8</code></li>
<li>参数 4：必选参数，文件写入完成后的回调函数</li>
</ol>
</li>
<li><p><code>fs.writeFile()</code> 的示例代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 第一步，导入fs对象 */</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">/* 第二步，写入内容 */</span></span><br><span class="line">fs.writeFile(<span class="string">&quot;./goudan1.txt&quot;</span>, <span class="string">&quot;531a&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入文件内容失败，错误信息为：&quot;</span> + err.message);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入文件内容成功&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    写入成功：err是null</span></span><br><span class="line"><span class="comment">    写入失败：err是错误对象</span></span><br><span class="line"><span class="comment">    如果文件不存在，会自动创建文件</span></span><br><span class="line"><span class="comment">    新内容会覆盖旧内容</span></span><br><span class="line"><span class="comment">    如果文件夹不存在，不会自动创建</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1-4-fs-整理考试成绩案例"><a href="#1-4-fs-整理考试成绩案例" class="headerlink" title="1.4 fs 整理考试成绩案例"></a>1.4 <code>fs</code> 整理考试成绩案例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入fs对象</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 读取成绩.txt</span></span><br><span class="line">fs.readFile(<span class="string">&quot;./成绩.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 判断是否读取成功</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;读取文件失败，失败的信息为：&quot;</span> + err.message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;读取文件成功，文件内容为：&quot;</span> + data);</span><br><span class="line">  <span class="comment">// 读取文件成功， 文件内容为： 小红=99 小白=100 小黄=70 小黑=66 小绿=88</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">        小红=99 小白=100 小黄=70 小黑=66 小绿=88</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        [&#x27;小红=99&#x27;,&#x27;小白=100&#x27;,&#x27;小黄=70&#x27;,&#x27;小黑=66&#x27;,&#x27;小绿=88&#x27;]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        [&#x27;小红:99&#x27;,&#x27;小白:100&#x27;,&#x27;小黄:70&#x27;,&#x27;小黑:66&#x27;,&#x27;小绿:88&#x27;]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        小红: 99</span></span><br><span class="line"><span class="comment">        小白: 100</span></span><br><span class="line"><span class="comment">        小黄: 70</span></span><br><span class="line"><span class="comment">        小黑: 66</span></span><br><span class="line"><span class="comment">        小绿: 88</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="comment">// console.log(data);</span></span><br><span class="line">  <span class="comment">// 把data字符串转成数组</span></span><br><span class="line">  <span class="keyword">const</span> oldArr = data.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">  <span class="comment">// console.log(oldArr);  [ &#x27;小红=99&#x27;, &#x27;小白=100&#x27;, &#x27;小黄=70&#x27;, &#x27;小黑=66&#x27;, &#x27;小绿=88&#x27; ]</span></span><br><span class="line">  <span class="comment">// 遍历数组，把数组元素中的 = 替换成 ：</span></span><br><span class="line">  <span class="keyword">const</span> newArr = [];</span><br><span class="line">  oldArr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    newArr.push(item.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;:&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// console.log(newArr);  [ &#x27;小红:99&#x27;, &#x27;小白:100&#x27;, &#x27;小黄:70&#x27;, &#x27;小黑:66&#x27;, &#x27;小绿:88&#x27; ]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把数组拼接成字符串（拼接符是换行）</span></span><br><span class="line">  <span class="keyword">const</span> str = newArr.join(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  <span class="comment">// console.log(str);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 写入内容到文件中</span></span><br><span class="line">  fs.writeFile(<span class="string">&quot;./成绩-ok.txt&quot;</span>, str, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 判断是否写入成功</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;写入文件内容失败&quot;</span>, err.message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入文件内容成功&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="2-path-路径模块"><a href="#2-path-路径模块" class="headerlink" title="2. path 路径模块"></a>2. <code>path</code> 路径模块</h1><h2 id="2-1-什么是-path-路径模块"><a href="#2-1-什么是-path-路径模块" class="headerlink" title="2.1 什么是 path 路径模块"></a>2.1 什么是 path 路径模块</h2><ol>
<li><code>path</code> 模块是 <code>Node.js</code> 官方提供的、用来处理路径的模块。它提供了一系列的方法和属性，用来满足用户对路径的处理需求，例如：</li>
</ol>
<ul>
<li><code>path.join()</code> 方法，用来将多个路径片段拼接成一个完整的路径字符串</li>
<li><code>path.basename()</code> 方法，用来从路径字符串中，将文件名解析出来</li>
</ul>
<ol>
<li><p>如果要在 JavaScript 代码中，使用 path 模块来处理路径，则需要使用如下的方式先导入它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = rquire(<span class="string">&quot;path&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-2-path-路径拼接"><a href="#2-2-path-路径拼接" class="headerlink" title="2.2 path 路径拼接"></a>2.2 path 路径拼接</h2><ol>
<li><p><code>path.join()</code> 的语法格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.join([...paths]);</span><br></pre></td></tr></table></figure>

<p>参数解读：</p>
<ol>
<li><code>...paths</code> <string> 路径片段的序列</li>
<li>返回值: <string></li>
</ol>
</li>
<li><p><code>path.join()</code> 的代码示例</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(path.join(__dirname, <span class="string">&quot;goudan.txt&quot;</span>), <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件读取失败，错误信息为：&quot;</span> + err.message);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件读取成功，内容为：&quot;</span> + data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2-3-path-basename-获取路径中的文件名"><a href="#2-3-path-basename-获取路径中的文件名" class="headerlink" title="2.3 path.basename() 获取路径中的文件名"></a>2.3 <code>path.basename()</code> 获取路径中的文件名</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; LOADIPHLPAPI &#125; = <span class="built_in">require</span>(<span class="string">&quot;dns&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&quot;F:/haha/index.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取路径中文件名</span></span><br><span class="line"><span class="comment">// 完整的名称</span></span><br><span class="line"><span class="keyword">const</span> n1 = path.basename(fpath);</span><br><span class="line"><span class="comment">// 不带后缀的名称</span></span><br><span class="line"><span class="keyword">const</span> n2 = path.basename(fpath, <span class="string">&quot;.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(n1); <span class="comment">//index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(n2); <span class="comment">//index</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-path-extname-获取路径中的文件扩展名"><a href="#2-4-path-extname-获取路径中的文件扩展名" class="headerlink" title="2.4 path.extname() 获取路径中的文件扩展名"></a>2.4 <code>path.extname()</code> 获取路径中的文件扩展名</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fpath = <span class="string">&quot;/a/b/c/d/index.html&quot;</span>; <span class="comment">// 文件的存放路径</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fullName = path.extname(fpath);</span><br><span class="line"><span class="built_in">console</span>.log(fullName); <span class="comment">// .html 返回文件的拓展名</span></span><br></pre></td></tr></table></figure>

<h1 id="3-时钟案例"><a href="#3-时钟案例" class="headerlink" title="3. 时钟案例"></a>3. 时钟案例</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    读取index.html,将其内容拆分3个文件</span></span><br><span class="line"><span class="comment">    读取文件内容</span></span><br><span class="line"><span class="comment">    提取css代码，写入到clock/index.css</span></span><br><span class="line"><span class="comment">    提取js代码，写入到clock/index.js</span></span><br><span class="line"><span class="comment">    提取html代码，写入到clock/index.html</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">// 正则对象</span></span><br><span class="line"><span class="keyword">const</span> regStyle = <span class="regexp">/&lt;style&gt;[\s\S]*&lt;\/style&gt;/</span>;</span><br><span class="line"><span class="keyword">const</span> regScript = <span class="regexp">/&lt;script&gt;[\s\S]*&lt;\/script&gt;/</span>;</span><br><span class="line"></span><br><span class="line">fs.readFile(path.join(__dirname, <span class="string">&quot;index.html&quot;</span>), <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 判断是否读取内容成功</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;读取内容失败,&quot;</span> + err.message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;读取内容成功,&quot;</span> + data);</span><br><span class="line">  resolveCss(data);</span><br><span class="line">  resolveJs(data);</span><br><span class="line">  resolveHTML(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveCss</span>(<span class="params">css</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> r1 = regStyle.exec(css); <span class="comment">//数组的第一个元素就是匹配到的内容</span></span><br><span class="line">  <span class="comment">// console.log(r1[0]);</span></span><br><span class="line">  <span class="comment">// 替换&lt;styl&gt;&lt;/styl&gt;为空字符串</span></span><br><span class="line">  <span class="keyword">const</span> strCSS = r1[<span class="number">0</span>].replace(<span class="string">&quot;&lt;style&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&lt;/style&gt;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// 把最终的结果，写入到clock/index.css文件中</span></span><br><span class="line">  fs.writeFile(</span><br><span class="line">    path.join(__dirname, <span class="string">&quot;clock/index.css&quot;</span>),</span><br><span class="line">    strCSS,</span><br><span class="line">    <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;写入css文件失败&quot;</span> + err.message);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;写入css文件成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveJs</span>(<span class="params">js</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//  使用正则表达式提取出页面中的 &lt;scrip&gt;&lt;/scrip&gt; 标签</span></span><br><span class="line">  <span class="keyword">const</span> r2 = regScript.exec(js);</span><br><span class="line">  <span class="comment">//  将提取出来的脚本字符串，做进一步处理</span></span><br><span class="line">  <span class="keyword">const</span> newJS = r2[<span class="number">0</span>].replace(<span class="string">&quot;&lt;script&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&lt;/script&gt;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">//  将提取出来的 js 脚本，写入到 index.js 文件中</span></span><br><span class="line">  fs.writeFile(path.join(__dirname, <span class="string">&quot;clock/index.js&quot;</span>), newJS, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;写入js文件失败&quot;</span>, err.message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入js文件成功&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolveHTML</span>(<span class="params">htmlStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newHTML = htmlStr</span><br><span class="line">    .replace(regStyle, <span class="string">&#x27;&lt;link rel=&quot;stylesheet&quot; href=&quot;./index.css&quot;&gt;&#x27;</span>)</span><br><span class="line">    .replace(regScript, <span class="string">&#x27;&lt;script src=&quot;./index.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(newHTML);</span><br><span class="line">  <span class="comment">// 写入文件</span></span><br><span class="line">  fs.writeFile(</span><br><span class="line">    path.join(__dirname, <span class="string">&quot;./clock/index.html&quot;</span>),</span><br><span class="line">    newHTML,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;写入 html文件失败！&quot;</span> + err.message);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;写入html文件成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>知识点：exec（）作用就是在字符串中 <strong>用 正则 来找 匹配的字符</strong></p>
<p>返回值是一个数组 ， 数组中第一个元素是<strong>匹配到的内容，</strong>第二个是匹配到内容的<strong>首文字在该字符串中的索引</strong>，第三个元素则是，你<strong>传进去的字符串。</strong></p>
<h1 id="4-http-模块"><a href="#4-http-模块" class="headerlink" title="4. http 模块"></a>4. <code>http</code> 模块</h1><ol>
<li><p><code>http</code> 模块是 <code>Node.js</code> 官方提供的、用来创建 <code>web</code> 服务器的模块。通过 <code>http</code> 模块提供的 <code>http.createServer()</code> 方法，就能方便的把一台普通的电脑，变成一台 <code>Web</code> 服务器，从而对外提供 <code>Web</code> 资源服务</p>
</li>
<li><p>如果要希望使用 <code>http</code> 模块创建 <code>Web</code> 服务器，则需要先导入它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="4-1-创建-web-服务器-★"><a href="#4-1-创建-web-服务器-★" class="headerlink" title="4.1 创建 web 服务器 ★"></a>4.1 创建 web 服务器 ★</h2><p>5.1 实现步骤和核心代码</p>
<ol>
<li><p>导入 http 模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>创建 web 服务器实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可快速创建一个 web 服务器实例</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br></pre></td></tr></table></figure></li>
<li><p>为服务器实例绑定 request 事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用服务器实例的 .on() 方法，为服务器绑定一个 request 事件</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 只要有客户端来请求我们自己的服务器，就会被触发 request 事件，从而调用这个事件处理程序</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;访问服务器成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>启动服务器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用服务器实例的 .listen() 方法，即可启动当前的 web 服务器实例</span></span><br><span class="line">server.listen(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;启动服务器成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="4-2-创建基本的服务器"><a href="#4-2-创建基本的服务器" class="headerlink" title="4.2 创建基本的服务器"></a>4.2 创建基本的服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 http.createServer() 方法，即可快速创建一个 web 服务器实例</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为服务器绑定一个 request 事件</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">        req是request的简写，请求对象(客户端请求相关的信息)</span></span><br><span class="line"><span class="comment">            req.url请求对象</span></span><br><span class="line"><span class="comment">            req.method请求方式</span></span><br><span class="line"><span class="comment">        res是respose的简写，响应对象(做出响应)</span></span><br><span class="line"><span class="comment">            res.end(&#x27;响应的数据&#x27;)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置响应头</span></span><br><span class="line">  res.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">  res.end(<span class="string">&quot;黑马程序员1212&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">server.listen(<span class="number">1212</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="4-3-解决中文乱码问题"><a href="#4-3-解决中文乱码问题" class="headerlink" title="4.3 解决中文乱码问题"></a>4.3 解决中文乱码问题</h2><p>当调用 <code>res.end()</code> 方法，向客户端发送中文内容的时候，会出现乱码问题，此时，需要手动设置内容的编码格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-4-根据不同的-url-响应不同的内容"><a href="#4-4-根据不同的-url-响应不同的内容" class="headerlink" title="4.4 根据不同的 url 响应不同的内容"></a>4.4 根据不同的 <code>url</code> 响应不同的内容</h2><p>​ 需求</p>
<p>​ <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/index.html%E5%93%8D%E5%BA%94%E2%80%9C%E6%AC%A2%E8%BF%8E%E8%AE%BF%E9%97%AE%E9%A6%96%E9%A1%B5%E2%80%9D">http://127.0.0.1:8080/index.html响应“欢迎访问首页”</a></p>
<p>​ <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/index.html%E5%93%8D%E5%BA%94%E2%80%9C%E6%AC%A2%E8%BF%8E%E5%88%97%E8%A1%A8%E9%A1%B5%E2%80%9D">http://127.0.0.1:8080/index.html响应“欢迎列表页”</a></p>
<p>​ 其他页面“not found”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"><span class="comment">// 方法一</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//判断请求地址  req.url 响应不同的地址</span></span><br><span class="line">  <span class="keyword">let</span> content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">&quot;/index.html&quot;</span> || req.url === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    content = <span class="string">&quot;欢迎访问首页&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === <span class="string">&quot;/list.hmtl&quot;</span>) &#123;</span><br><span class="line">    content = <span class="string">&quot;欢迎访问列表页&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    content = <span class="string">&quot;not found&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//设置响应头</span></span><br><span class="line">  res.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">  res.end(content);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//方法二</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置响应头</span></span><br><span class="line">  res.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">  <span class="comment">// 判断请求地址  req.url 响应不同的内容</span></span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">&quot;/index.html&quot;</span> || req.url === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;欢迎访问首页&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.url === <span class="string">&quot;/list.html&quot;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;欢迎访问列表页&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&quot;not found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="5-时钟-web-服务器案例"><a href="#5-时钟-web-服务器案例" class="headerlink" title="5. 时钟 web 服务器案例"></a>5. 时钟 <code>web</code> 服务器案例</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 http、fs、path 模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"><span class="comment">// 监听 web 服务器的 request 事件</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取url地址</span></span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  <span class="comment">// 预定义空白的文件存放路径</span></span><br><span class="line">  <span class="keyword">let</span> fpath = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (url === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果请求的路径是 / ，则手动指定文件的存放路径</span></span><br><span class="line">    fpath = path.join(__dirname, <span class="string">&quot;/clock/index.html&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果请求的路径不为 / ，则动态拼接文件的存放路径</span></span><br><span class="line">    fpath = path.join(__dirname, <span class="string">&quot;/clock&quot;</span>, url);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 读取文件内容，响应回去</span></span><br><span class="line">  fs.reafFile(fpath, <span class="string">&quot;utf8&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.end(<span class="string">&quot;not found&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.end(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务器</span></span><br><span class="line">server.listen(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;启动服务器成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="6-Node-中的模块化"><a href="#6-Node-中的模块化" class="headerlink" title="6. Node 中的模块化"></a>6. <code>Node</code> 中的模块化</h1><h2 id="6-1-模块化"><a href="#6-1-模块化" class="headerlink" title="6.1 模块化"></a>6.1 模块化</h2><p>模块化是一种思想。（拆分和组合，达到复用目的）</p>
<p>编程中也需要模块化的思想，把一个一个的小功能拆分成一个一个的模块。<br>当实现一个大功能时，可以像搭积木一样，把小模块按照需求组合起来。</p>
<h2 id="6-2-模块的分类"><a href="#6-2-模块的分类" class="headerlink" title="6.2 模块的分类"></a>6.2 模块的分类</h2><ol>
<li><p><strong>内置模块</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载内置的 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>自定义模块</strong> （自己创建的 js 文件，一个 js 文件就是一个模块）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 加载用户的自定义模块</span></span><br><span class="line"><span class="keyword">const</span> custom = <span class="built_in">require</span>(<span class="string">&quot;./custom.js&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>第三方模块</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 加载第三方模块，(使用第三方模块也就是包)</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&quot;moment&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>注意 1：加载模块时，对应模块中的代码就会被执行。</p>
<p>注意 2：可以省略文件的后缀.js</p>
</li>
</ol>
<h2 id="6-3-模块的作用域"><a href="#6-3-模块的作用域" class="headerlink" title="6.3 模块的作用域"></a>6.3 模块的作用域</h2><p>在当前模块中定义的变量、常量、函数，只能在当前模块使用。</p>
<p>好处：防止了全局变量污染、文件依赖等问题的产生.</p>
<h2 id="6-4-模块成员"><a href="#6-4-模块成员" class="headerlink" title="6.4 模块成员"></a>6.4 模块成员</h2><p>在当前模块中定义的变量、常量、函数，统称为“模块成员”</p>
<h2 id="6-5-module-exports-对象-★"><a href="#6-5-module-exports-对象-★" class="headerlink" title="6.5 module.exports 对象 ★"></a>6.5 <code>module.exports</code> 对象 ★</h2><p>在每个 <code>.js</code> 自定义模块中都有一个 <code>module</code> 对象，它里面存储了和当前模块有关的信息</p>
<ol>
<li>==在自定义模块中，可以使用 <code>module.exports</code> 对象，将模块内的成员共享出去，供外界使用==</li>
<li>==外界用 <code>require()</code> 方法导入自定义模块时，得到的就是 <code>module.exports</code> 所指向的对象==</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/123.png"></p>
<h2 id="6-6-module-exports-对象一键共享多个成员"><a href="#6-6-module-exports-对象一键共享多个成员" class="headerlink" title="6.6 module.exports 对象一键共享多个成员"></a>6.6 <code>module.exports</code> 对象一键共享多个成员</h2><p><img src= "/img/loading.gif" data-lazy-src="/images/456.png"></p>
<h2 id="6-7-exports-对象"><a href="#6-7-exports-对象" class="headerlink" title="6.7 exports 对象"></a>6.7 <code>exports</code> 对象</h2><p>由于 <code>module.exports</code> 单词写起来比较复杂，为了简化向外共享成员的代码，<code>Node</code> 提供了 <code>exports</code> 对象。默认情况下，<code>exports</code> 和 <code>module.exports</code> 指向同一个对象。最终共享的结果，还是以 <code>module.exports</code> 指向的对象为准</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">exports</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认情况下，`exports` 和 `module.exports` 指向同一个对象</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">exports</span> === <span class="built_in">module</span>.exports); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将私有成员共享出去</span></span><br><span class="line"><span class="built_in">exports</span>.username = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接挂载方法</span></span><br><span class="line"><span class="built_in">exports</span>.sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Hellp&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="6-8-exports-和-module-exports-的使用误区"><a href="#6-8-exports-和-module-exports-的使用误区" class="headerlink" title="6.8 exports 和 module.exports 的使用误区"></a>6.8 <code>exports</code> 和 <code>module.exports</code> 的使用误区</h2><ol>
<li>时刻谨记，<code>require()</code> 模块时，得到的永远是 <code>module.exports</code> 指向的对象</li>
<li><strong>注意：为了防止混乱，建议大家不要在同一个模块中同时使用 <code>exports</code> 和 <code>module.exports</code></strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.username = <span class="string">&quot;Tom&quot;</span>; <span class="comment">// 不会被打印</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.username = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不会被执行</span></span><br><span class="line"><span class="built_in">exports</span> = &#123;</span><br><span class="line">  gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个都会执行</span></span><br><span class="line"><span class="built_in">module</span>.exports.username = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.gender = <span class="string">&quot;男&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三个都会打印</span></span><br><span class="line"><span class="built_in">exports</span> = &#123;</span><br><span class="line">  gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">exports</span>;</span><br><span class="line"><span class="built_in">module</span>.exports.username = <span class="string">&quot;Tom&quot;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="7-npm-初体验-（包）"><a href="#7-npm-初体验-（包）" class="headerlink" title="7. npm 初体验 （包）"></a>7. <code>npm</code> 初体验 （包）</h1><h2 id="7-1-使用第三方包对时间进行格式化"><a href="#7-1-使用第三方包对时间进行格式化" class="headerlink" title="7.1 使用第三方包对时间进行格式化"></a>7.1 使用第三方包对时间进行格式化</h2><ol>
<li><p>使用 <code>npm</code> 包管理工具，在项目中安装格式化时间的包 <code>moment</code></p>
</li>
<li><p>使用 <code>require()</code> 导入格式化时间的包</p>
</li>
<li><p>参考 <code>moment</code> 的官方 <code>API</code> 文档对时间进行格式化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.moment</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&quot;moment&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.参考 moment 官方 API 文档，调用对应的方法，对时间进行格式化</span></span><br><span class="line"><span class="comment">// 2.1 调用 moment() 方法，得到当前的事件</span></span><br><span class="line"><span class="comment">// 2.2 针对当前的时间，调用 format() 方法，按照指定的格式进行时间的格式化</span></span><br><span class="line"><span class="keyword">const</span> dt = moment().format(<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(dt);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="7-2-npm-install-命令安装包"><a href="#7-2-npm-install-命令安装包" class="headerlink" title="7.2 npm install 命令安装包"></a>7.2 <code>npm install</code> 命令安装包</h2><ol>
<li><p>如果想在项目中安装指定名称的包，需要运行如下的命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install 包的完整名称</span><br></pre></td></tr></table></figure></li>
<li><p>上述的装包命令，可以简写成如下格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i 包的完整名称</span><br><span class="line">npm i moment</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="7-3-设置指定版本的包"><a href="#7-3-设置指定版本的包" class="headerlink" title="7.3 设置指定版本的包"></a>7.3 设置指定版本的包</h2><p>默认情况下，使用 <code>npm install</code> 命令安装包的时候，会自动安装最新版本的包。如果需要安装指定版本的包，可以在包名之后，通过 <code>@ </code>符号指定具体的版本，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i moment@<span class="number">2.22</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<h2 id="7-4-卸载包"><a href="#7-4-卸载包" class="headerlink" title="7.4 卸载包"></a>7.4 卸载包</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall 包名</span><br></pre></td></tr></table></figure>

<h2 id="7-5-解决包下载速度慢的问题"><a href="#7-5-解决包下载速度慢的问题" class="headerlink" title="7.5 解决包下载速度慢的问题"></a>7.5 解决包下载速度慢的问题</h2><ol>
<li><p>通过 npm 包管理器，将 nrm 安装为全局可用的工具</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i nrm -g</span><br></pre></td></tr></table></figure></li>
<li><p>查看下载列表</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm ls</span><br></pre></td></tr></table></figure></li>
<li><p>切换默认下载地址</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="8-包管理配置"><a href="#8-包管理配置" class="headerlink" title="8. 包管理配置"></a>8. 包管理配置</h1><h2 id="8-1-package-json"><a href="#8-1-package-json" class="headerlink" title="8.1 package.json"></a>8.1 <code>package.json</code></h2><ul>
<li><p>在项目根目录中，创建一个叫做 **<code>package.json</code>**的配置文件，即可用来记录项目中安装了哪些包。从而方便剔除 <code>node_modules</code> 目录之后，在团队成员之间共享项目的源代码</p>
</li>
<li><p>今后在项目开发中，一定要把 <code>node_modules</code> 文件夹，添加到 <code>.gitignore</code> 忽略文件中</p>
</li>
</ul>
<h2 id="8-2-快速创建-package-json"><a href="#8-2-快速创建-package-json" class="headerlink" title="8.2 快速创建 package.json"></a>8.2 快速创建 <code>package.json</code></h2><p><code>npm</code> 包管理工具提供了一个快捷命令，可以在执行命令时所处的目录中，快速创建 <code>package.json</code> 这个包管理配置文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>上述命令<strong>只能在英文的目录下成功运行！</strong>所以，项目文件夹的名称<strong>一定要使用英文命名，不要使用中文，不能出现空格</strong></li>
<li>运行 <code>npm install</code> 命令安装包的时候，<code>npm</code> 包管理工具会自动把包的名称和版本号，记录到 <code>package.json</code> 中</li>
</ol>
<h2 id="8-3-一次性安装所有包"><a href="#8-3-一次性安装所有包" class="headerlink" title="8.3 一次性安装所有包"></a>8.3 一次性安装所有包</h2><p>当我们拿到一个剔除了 node_modules 的项目之后，需要先把所有的包下载到项目中，才能将项目运行起来。</p>
<p>可以运行 <code>npm install</code> 命令（或 <code>npm i</code>）一次性安装所有的依赖包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure>

<h1 id="9-包的分类"><a href="#9-包的分类" class="headerlink" title="9. 包的分类"></a>9. 包的分类</h1><h2 id="9-1-项目包"><a href="#9-1-项目包" class="headerlink" title="9.1 项目包"></a>9.1 项目包</h2><ol>
<li>那些被安装到项目的 <code>node_modules</code> 目录中的包，都是项目包</li>
<li>项目包又分为两类，分别是：</li>
</ol>
<ul>
<li>开发依赖包，被记录到 <code>devDependencies</code> 节点中的包，<strong>只在开发期间会用到</strong></li>
<li>核心依赖包，被记录到 <code>dependencies</code> 节点中的包，<strong>在开发期间和项目上线之后都会用到</strong><br>![](/images/010 - 项目包.png)</li>
</ul>
<h2 id="9-2-全局包"><a href="#9-2-全局包" class="headerlink" title="9.2 全局包"></a>9.2 全局包</h2><ol>
<li>在执行 <code>npm install</code> 命令时，如果提供了 <code>-g</code> 参数，则会把包安装为全局包</li>
<li>全局包会被安装到 <code>C:\Users\用户目录\AppData\Roaming\npm\node_modules</code> 目录下</li>
<li>注意：</li>
</ol>
<ul>
<li>只有工具性质的包，才有全局安装的必要性。因为它们提供了好用的终端命令</li>
<li>判断某个包是否需要全局安装后才能使用，可以参考官方提供的使用说明即可<br>![](/images/011 - 全局包.png)</li>
</ul>
<h2 id="9-3-i5ting-toc-的安装和使用"><a href="#9-3-i5ting-toc-的安装和使用" class="headerlink" title="9.3 i5ting_toc 的安装和使用"></a>9.3 <code>i5ting_toc</code> 的安装和使用</h2><ol>
<li><p><code>i5ting_toc</code> 是一个可以把 <code>md</code> 文档转为 <code>html</code> 页面的小工具<br>![](/images/012 - i5ting_toc.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">i5ting_toc -f 要转换的md文件路径 -0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="10-express"><a href="#10-express" class="headerlink" title="10. express"></a>10. express</h1><h2 id="10-1-Express-的基本使用"><a href="#10-1-Express-的基本使用" class="headerlink" title="10.1 Express 的基本使用"></a>10.1 Express 的基本使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在项目所处的目录中，运行如下的终端命令，即可将 express 安装到项目中使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express</span><br></pre></td></tr></table></figure>

<h3 id="导入-express"><a href="#导入-express" class="headerlink" title="导入 express"></a>导入 express</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建-web-服务器"><a href="#创建-web-服务器" class="headerlink" title="创建 web 服务器"></a>创建 web 服务器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = express();</span><br></pre></td></tr></table></figure>

<h3 id="监听请求"><a href="#监听请求" class="headerlink" title="监听请求"></a>监听请求</h3><h3 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="10-2-监听-GET-和-POST-请求，并影响客户端"><a href="#10-2-监听-GET-和-POST-请求，并影响客户端" class="headerlink" title="10.2 监听 GET 和 POST 请求，并影响客户端"></a>10.2 监听 GET 和 POST 请求，并影响客户端</h2><ol>
<li><p>监听 <code>GET</code> 请求</p>
<ul>
<li>通过 <code>app.get()</code> 方法，可以监听客户端的 GET 请求，具体的语法格式如下<br>![](/images/017 - 监听 GET 请求.png)</li>
</ul>
</li>
<li><p>监听 <code>POST</code> 请求</p>
<ul>
<li>通过 <code>app.post()</code> 方法，可以监听客户端的 POST 请求，具体的语法格式如下<br>![](/images/018 - 监听 POST 请求.png)</li>
</ul>
</li>
<li><p>把内容响应给客户端</p>
</li>
</ol>
<ul>
<li>通过 <code>res.send()</code> 方法，可以把处理好的内容，发送给客户端<br>![](/images/019 - send.png)</li>
</ul>
<h3 id="10-2-1-http-创建服务器："><a href="#10-2-1-http-创建服务器：" class="headerlink" title="10.2.1 http 创建服务器："></a>10.2.1 http 创建服务器：</h3><p>​ 需求：</p>
<p>​ get 请求：</p>
<p>​ <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/api/getusers">http://127.0.0.1:8080/api/getusers</a></p>
<p>​ 响应：“获取用户列表成功”</p>
<p>​ post 请求：</p>
<p>​ <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/api/addusers">http://127.0.0.1:8080/api/addusers</a></p>
<p>​ 响应：“ 添加用户成功”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 创建服务器对象</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"><span class="comment">// 绑定request事件</span></span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断请求方式</span></span><br><span class="line">  <span class="keyword">if</span> (req.method === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.url === <span class="string">&quot;/api/getusers&quot;</span>) &#123;</span><br><span class="line">      res.end(<span class="string">&quot;得到用户信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.method === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.url === <span class="string">&quot;/api/addusers&quot;</span>) &#123;</span><br><span class="line">      res.end(<span class="string">&quot;添加用户成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">server.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;启动服务器成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="10-2-2-express-创建服务器："><a href="#10-2-2-express-创建服务器：" class="headerlink" title="10.2.2 express 创建服务器："></a>10.2.2 express 创建服务器：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 2. 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 监听get请求</span></span><br><span class="line">app.get(<span class="string">&quot;/api/getusers&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;获取用户成功啦&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    name: <span class="string">&quot;赵四&quot;</span>,</span><br><span class="line">    age: <span class="number">50</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听post请求</span></span><br><span class="line">app.post(<span class="string">&quot;/api/addusers&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;添加用户成功啦&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 3. 调用 app.listen(端口号, 启动后的回调函数), 启动服务器</span></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="10-3-获取-URL-中携带的查询参数"><a href="#10-3-获取-URL-中携带的查询参数" class="headerlink" title="10.3 获取 URL 中携带的查询参数"></a>10.3 获取 URL 中携带的查询参数</h2><ol>
<li>通过 <code>req.query</code> 对象，可以访问到客户端通过查询字符串的形式，发送到服务器的参数<br>![](/images/020 - 获取 URL 中携带的查询参数.png)</li>
</ol>
<h2 id="10-4-获取-URL-中的动态参数"><a href="#10-4-获取-URL-中的动态参数" class="headerlink" title="10.4 获取 URL 中的动态参数"></a>10.4 获取 URL 中的动态参数</h2><ol>
<li><p>通过 <code>req.params</code> 对象，可以访问到 <code>URL</code> 中，通过 : 匹配到的动态参数<br>![](/images/021 - 获取 URL 中的动态参数.png)</p>
</li>
<li><p>补充知识点</p>
</li>
</ol>
<ul>
<li><code>/:id​</code> – id 值不是固定的，可以自己定义，例如： <code>/:ids</code></li>
<li>展示到页面中的 <code>id</code> 键，是自定义的变量值</li>
<li>参数可以有多个，例如： <code>/:ids/:name</code></li>
</ul>
<h2 id="10-5-获取-URL-中的参数"><a href="#10-5-获取-URL-中的参数" class="headerlink" title="10.5 获取 URL 中的参数"></a>10.5 获取 URL 中的参数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 2. 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 监听get请求</span></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 接收客户端的查询参数（查询字符串）</span></span><br><span class="line">  <span class="comment">// req.query&#123;&#125;</span></span><br><span class="line">  res.send(req.query);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    查询字符串：http://127.0.0.1:8080?name=zs&amp;age=30</span></span><br><span class="line"><span class="comment">    动态参数： http://127.0.0.1:8080/zs/age</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 第1步，在监听的url地址中，:参数名 的方式设置参数（占位符）</span></span><br><span class="line">app.get(<span class="string">&quot;/user/:id/:name/:age&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 第2步，通过req.params获取动态参数</span></span><br><span class="line">  res.send(req.params);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听post请求</span></span><br><span class="line">app.post(<span class="string">&quot;/api/addusers&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;添加用户成功啦&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 3. 调用 app.listen(端口号, 启动后的回调函数), 启动服务器</span></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="10-6-托管静态资源"><a href="#10-6-托管静态资源" class="headerlink" title="10.6 托管静态资源"></a>10.6 托管静态资源</h2><h3 id="10-6-1-express-static"><a href="#10-6-1-express-static" class="headerlink" title="10.6.1 express.static()"></a>10.6.1 <code>express.static()</code></h3><ol>
<li><code>express</code> 提供了一个非常好用的函数，叫做 <code>express.static()</code>，通过它，我们可以非常方便地创建一个静态资源服务器，<br>例如，通过如下代码就可以将 <code>public</code> 目录下的图片、<code>CSS</code> 文件、<code>JavaScript</code> 文件对外开放访问了</li>
<li><code>app.use(express.static(&#39;clock&#39;));</code> 在浏览器直接输入 <a target="_blank" rel="noopener" href="http://127.0.0.1/index.html">http://127.0.0.1/index.html</a> 就可以直接访问，不需要在 index.html 前面加 clock<br>![](/images/022 - express.static().png)</li>
</ol>
<p>完整代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    静态资源托管：</span></span><br><span class="line"><span class="comment">        客户端请求静态资源文件（html、css、js、图片）</span></span><br><span class="line"><span class="comment">        服务器会自动到指定文件夹下读取对应文件的内容，响应返回的数据</span></span><br><span class="line"><span class="comment">    app.use(express.static(&#x27;clock&#x27;));</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(express.static(<span class="string">&quot;clock&quot;</span>));</span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="10-6-2-托管多个静态资源目录"><a href="#10-6-2-托管多个静态资源目录" class="headerlink" title="10.6.2 托管多个静态资源目录"></a>10.6.2 托管多个静态资源目录</h3><ol>
<li>如果要托管多个静态资源目录，请多次调用 <code>express.static()</code> 函数，<br>访问静态资源文件时，<code>express.static()</code> 函数会根据目录的添加顺序查找所需的文件<br>![](/images/023 - 托管多个静态资源目录.png)</li>
</ol>
<p>完整代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这里，调用 express.static() 方法，快速的对外提供静态资源</span></span><br><span class="line">app.use(express.static(<span class="string">&quot;public&quot;</span>));</span><br><span class="line">app.use(express.static(<span class="string">&quot;static&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="10-6-3-挂载路径前缀"><a href="#10-6-3-挂载路径前缀" class="headerlink" title="10.6.3 挂载路径前缀"></a>10.6.3 挂载路径前缀</h3><ol>
<li>如果希望在托管的静态资源访问路径之前，挂载路径前缀，则可以使用如下的方式<br>![](/images/024 - 挂载路径前缀.png)</li>
</ol>
<p>完整代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这里，调用 express.static() 方法，快速的对外提供静态资源</span></span><br><span class="line">app.use(<span class="string">&quot;/static&quot;</span>, express.static(<span class="string">&quot;public&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="11-路由"><a href="#11-路由" class="headerlink" title="11. 路由"></a>11. 路由</h1><h2 id="11-1-Express-路由"><a href="#11-1-Express-路由" class="headerlink" title="11.1 Express 路由"></a>11.1 <code>Express</code> 路由</h2><p>路由：一种映射关系</p>
<p>express 路由：==客户端的请求==和==服务器处理函数==之间的==映射关系==</p>
<h2 id="11-2-路由挂载"><a href="#11-2-路由挂载" class="headerlink" title="11.2 路由挂载"></a>11.2 路由挂载</h2><p>监听客户端请求，也叫挂载路由</p>
<h2 id="11-3-路由匹配"><a href="#11-3-路由匹配" class="headerlink" title="11.3 路由匹配"></a>11.3 路由匹配</h2><p>如果请求类型和请求地址，匹配成功就执行对应的处理函数</p>
<p>从上往下一次匹配，匹配成功就不会继续往下匹配</p>
<h2 id="11-4-Express-路由最简单的用法"><a href="#11-4-Express-路由最简单的用法" class="headerlink" title="11.4 Express 路由最简单的用法"></a>11.4 Express 路由最简单的用法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line">app.get(<span class="string">&quot;/api/getuser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;获取用户成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">&quot;/api/adduser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;添加用户成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">&quot;/api/edituser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;编辑用户成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&quot;/api/deluser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;删除用户成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 开启路由器</span></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>效果：</strong><br><img src= "/img/loading.gif" data-lazy-src="/images/%E8%B7%AF%E7%94%B11.png"></p>
<h2 id="11-5-模块化路由"><a href="#11-5-模块化路由" class="headerlink" title="11.5 模块化路由"></a>11.5 模块化路由</h2><p>​ 为了方便对路由进行模块化的管理，<code>Express</code> 不建议将路由直接挂载到 <code>app</code> 上，而是推荐将路由抽离为单独的模块，将路由抽离为单独模块的步骤如下</p>
<ul>
<li>创建路由模块对应的 <code>.js</code> 文件</li>
<li>调用 <code>express.Router()</code>函数创建路由对象</li>
<li>向路由对象上挂载具体的路由</li>
<li>使用 <code>module.exports</code> 向外共享路由对象</li>
<li>使用 <code>app.use()</code> 函数注册路由模块</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%B7%AF%E7%94%B12.png"></p>
<h2 id="11-6-把路由处理函数放到单独的模块-★"><a href="#11-6-把路由处理函数放到单独的模块-★" class="headerlink" title="11.6 把路由处理函数放到单独的模块 ★"></a>11.6 把路由处理函数放到单独的模块 ★</h2><p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%B7%AF%E7%94%B14.png"></p>
<h1 id="12-中间件"><a href="#12-中间件" class="headerlink" title="12. 中间件"></a>12. 中间件</h1><h2 id="12-1-Express-中间件"><a href="#12-1-Express-中间件" class="headerlink" title="12.1 Express 中间件"></a>12.1 Express 中间件</h2><p>所谓的中间件（<code>Middleware</code> ），特指业务流程的<strong>中间处理环节</strong></p>
<p>express 的中间件：请求和响应之间的处理环节</p>
<h2 id="12-2-Express-中间件的格式"><a href="#12-2-Express-中间件的格式" class="headerlink" title="12.2 Express 中间件的格式"></a>12.2 Express 中间件的格式</h2><p>Express 的中间件，<strong>本质上就是一个 <code>function</code> 处理函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>next 函数</strong>是实现<strong>多个中间件连续调用</strong>的关键，它表示把流转关系<strong>转交</strong>给下一个<strong>中间件</strong>或<strong>路由</strong></p>
<h2 id="12-3-全局生效的中间件-○"><a href="#12-3-全局生效的中间件-○" class="headerlink" title="12.3 全局生效的中间件 ○"></a>12.3 全局生效的中间件 ○</h2><ol>
<li>客户端发起的<strong>任何请求</strong>，到达服务器之后，都会触发的中间件，叫做全局生效的中间件</li>
<li>通过调用 <code>app.use(中间件函数)</code>，即可顶一个全局生效的中间件</li>
<li>定义全局中间件也可以将中间件函数直接挂载到 <code>app.use()</code> 上面</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 定义一个中间件（全局中间件，所有的请求过来都会执行它）</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line">  <span class="comment">// 交给下一个中间件或者路由处理函数进行处理</span></span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line">app.get(<span class="string">&quot;/api/getuser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;获取人员成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&quot;/api/deluser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;删除人员成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 开启服务器</span></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="12-4-定义多个全局中间件"><a href="#12-4-定义多个全局中间件" class="headerlink" title="12.4 定义多个全局中间件"></a>12.4 定义多个全局中间件</h2><ol>
<li><p>可以使用 <code>app.use()</code> 连续定义多个全局中间件，客户端请求到达服务器之后，会按照中间件定义的先后顺序依次执行</p>
</li>
<li><p>案例代码</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个全局中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;调用了第一个全局的中间件&quot;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个全局中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;调用了第二个全局的中间件&quot;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义路由</span></span><br><span class="line"><span class="comment">// 请求这两个路由，会依次触发上述两个全局中间件</span></span><br><span class="line">app.get(<span class="string">&quot;/user&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;User Page&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="12-5-局部生效的中间件-○"><a href="#12-5-局部生效的中间件-○" class="headerlink" title="12.5 局部生效的中间件 ○"></a>12.5 局部生效的中间件 ○</h2><ol>
<li><p>不使用 <code>app.use()</code> 定义的中间件，叫做局部生效的中间件</p>
</li>
<li><p>案例代码</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    局部中间件：只对某一个请求进行预处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> m1 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> m2 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;m2&quot;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line"><span class="comment">// m1 m2 这个中间件只在 &quot;当前路由中生效&quot;，这种用法属于 &quot;局部生效的中间件&quot;</span></span><br><span class="line"><span class="comment">// 请求这两个路由，会依次触发上述两个全局中间件</span></span><br><span class="line">app.get(<span class="string">&quot;/user&quot;</span>, m1, m2, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;User Page&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&quot;/text&quot;</span>, [m1, m2], <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;User ok&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="12-6-中间件的作用"><a href="#12-6-中间件的作用" class="headerlink" title="12.6 中间件的作用"></a>12.6 中间件的作用</h2><ol>
<li><p>多个中间件之间，共享同一份 <code>req</code> 和 <code>res</code>，基于这样的特性，我们可以在<strong>上游</strong> 的中间件中，统一为 <code>req</code> 或 <code>res</code> 对象添加自定义的属性和方法，供下游的中间件或路由进行使用<br>![](/images/009 - 中间件的作用.png)</p>
</li>
<li><p>案例代码</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 给req添加属性</span></span><br><span class="line">  req.startTime = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="comment">// 给res添加方法</span></span><br><span class="line">  res.cc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line"><span class="comment">// 请求这两个路由，会依次触发上述两个全局中间件</span></span><br><span class="line">app.get(<span class="string">&quot;/user&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.cc();</span><br><span class="line">  res.send(<span class="string">&quot;User Page&quot;</span> + req.startTime);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="12-7-中间件的-5-个使用注意事项"><a href="#12-7-中间件的-5-个使用注意事项" class="headerlink" title="12.7 中间件的 5 个使用注意事项"></a>12.7 中间件的 5 个使用注意事项</h2><ol>
<li>一定要在路由之前注册中间件</li>
<li>客户端发送过来的请求，可以连续调用多个中间件进行处理</li>
<li>执行完中间件的业务代码之后，不要忘记调用 <code>next()</code> 函数</li>
<li>为了防止代码逻辑混乱，调用 <code>next()</code> 函数后不要再写额外的代码</li>
<li>连续调用多个中间件时，多个中间件之间，共享 <code>req</code> 和 <code>res</code> 对象</li>
</ol>
<h1 id="13-中间件的分类"><a href="#13-中间件的分类" class="headerlink" title="13. 中间件的分类"></a>13. 中间件的分类</h1><h2 id="13-1-中间件的分类"><a href="#13-1-中间件的分类" class="headerlink" title="13.1 中间件的分类"></a>13.1 中间件的分类</h2><ol>
<li>为了方便大家理解和记忆中间件的使用，Express 官方把常见的中间件用法，分成了 5 大类，分别是</li>
</ol>
<ul>
<li>应用级别的中间件</li>
<li>路由级别的中间件</li>
<li>错误级别的中间件</li>
<li>Express 内置的中间件</li>
<li>第三方的中间件</li>
</ul>
<h2 id="13-2-应用级别的中间件"><a href="#13-2-应用级别的中间件" class="headerlink" title="13.2 应用级别的中间件"></a>13.2 应用级别的中间件</h2><p>通过 <code>app.use()</code> 或 <code>app.get()</code> 或 <code>app.post()</code> ，<strong>绑定到 <code>app</code> 实例上的中间件</strong>，叫做应用级别的中间件<br>![](/images/010 - 应用级别的中间件.png)</p>
<h2 id="13-3-路由级别的中间件"><a href="#13-3-路由级别的中间件" class="headerlink" title="13.3 路由级别的中间件"></a>13.3 路由级别的中间件</h2><ol>
<li>绑定到 <code>express.Router()</code> 实例上的中间件，叫做路由级别的中间件</li>
<li>用法上和应用级别中间件没有任何区别，只不过，应用级别中间件是绑定到 <code>app</code> 实例上，路由级别中间件绑定到 <code>router</code> 实例上<br>![](/images/011 - 路由级别的中间件.png)</li>
</ol>
<h2 id="13-4-错误级别中间件-○"><a href="#13-4-错误级别中间件-○" class="headerlink" title="13.4 错误级别中间件 ○"></a>13.4 错误级别中间件 ○</h2><ol>
<li>错误级别中间件的作用： 专门用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题</li>
<li>格式：错误级别中间件的 function 处理函数中，必须有 4 个形参，形参顺序从前到后，分别是<code>(err, req, res, next)</code></li>
<li>注意： ==错误级别的中间件，必须注册在所有路由之后==</li>
<li>案例代码：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 路由</span></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1.1 抛出一个自定义的错误</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;服务器内部发生了错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">  res.send(<span class="string">&quot;Home Page.&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 错误级别的中间件</span></span><br><span class="line"><span class="comment">// 注意：错误级别的中间件，必须注册在所有路由之后</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 2.1 在服务器打印错误消息</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;发生了错误：&quot;</span> + err.message);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.2 向客户端响应错误相关的内容</span></span><br><span class="line">  res.send(err.message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="13-5-Express-内置的中间件-○"><a href="#13-5-Express-内置的中间件-○" class="headerlink" title="13.5 Express 内置的中间件 ○"></a>13.5 Express 内置的中间件 ○</h2><p>自 <code>Express 4.16.0</code> 版本开始，<code>Express</code> 内置了 3 个常用的中间件，极大的提高了 <code>Express</code> 项目的开发效率和体验</p>
<ol>
<li><code>express.static</code> 快速托管静态资源的内置中间件，例如： HTML 文件、图片、<code>CSS</code> 样式等（无兼容性）</li>
<li><code>express.json</code> 解析 <code>JSON</code> post 请求 json 格式的请求体数据（<strong>有兼容性</strong>，仅在 <code>4.16.0+</code> 版本中可用）</li>
<li><code>express.urlencoded</code> 解析 <code>URL-encoded</code> post 请求中键值对格式的请求体数据（<strong>有兼容性</strong>，仅在 <code>4.16.0+</code> 版本中可用）<br>![](/images/012 - Express 内置的中间件.png)</li>
</ol>
<h3 id="13-5-1-express-json-中间件的使用"><a href="#13-5-1-express-json-中间件的使用" class="headerlink" title="13.5.1 express.json 中间件的使用"></a>13.5.1 <code>express.json</code> 中间件的使用</h3><ol>
<li><code>express.json()</code> 中间件，解析表单中的 <code>JSON</code> 格式的数据</li>
<li>案例代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：除了错误级别的中间件，其他的中间件，必须在路由之前进行配置</span></span><br><span class="line"><span class="comment">// 通过 express.json() 这个中间件，解析表单中的 JSON 格式的数据</span></span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/user&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 在服务器，可以使用 req.body 这个属性，来接收客户端发送过来的请求体数据</span></span><br><span class="line">  <span class="comment">// 默认情况下，如果不配置解析表单数据中间件，则 req.body 默认等于 undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="13-5-2-express-urlencoded-中间件的使用"><a href="#13-5-2-express-urlencoded-中间件的使用" class="headerlink" title="13.5.2 express.urlencoded 中间件的使用"></a>13.5.2 <code>express.urlencoded</code> 中间件的使用</h3><ol>
<li><code>express.urlencoded</code> 解析 <code>URL-encoded</code> 格式的请求体数据</li>
<li>案例代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 express.urlencoded() 这个中间件，来解析表单中的 url-encoded 格式的数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/book&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">  res.send(req.body);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="13-6-第三方的中间件"><a href="#13-6-第三方的中间件" class="headerlink" title="13.6 第三方的中间件"></a>13.6 第三方的中间件</h2><ol>
<li>非 <code>Express</code> 官方内置，而是由第三方开发出来的中间件，叫做第三方中间件。在项目中，大家可以按需下载并配置第三方中间件，从而提高项目的开发效率</li>
<li>例如：在 <code>express@4.16.0</code> 之前的版本中，经常使用 <code>body-parser</code> 这个第三方中间件，来解析请求体数据。使用步骤如下<ul>
<li>运行 <code>npm install body-parser</code> 安装中间件</li>
<li>使用 <code>require</code> 导入中间件</li>
<li>调用 <code>app.use()</code> 注册并使用中间件</li>
</ul>
</li>
<li><strong>注意：<code>Express</code> 内置的 <code>express.urlencoded</code> 中间件，就是基于 <code>body-parser</code> 这个第三方中间件进一步封装出来的</strong></li>
<li>案例代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入解析表单数据的中间件 body-parser</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 express.urlencoded() 这个中间件，来解析表单中的 url-encoded 格式的数据</span></span><br><span class="line"><span class="comment">// app.use(express.urlencoded(&#123; extended: false &#125;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用 app.use() 注册中间件</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/book&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">  res.send(req.body);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="14-自定义中间件"><a href="#14-自定义中间件" class="headerlink" title="14. 自定义中间件"></a>14. 自定义中间件</h1><h2 id="14-1-需求以及实现步骤"><a href="#14-1-需求以及实现步骤" class="headerlink" title="14.1 需求以及实现步骤"></a>14.1 需求以及实现步骤</h2><ol>
<li>需求描述： 自己手动模拟一个类似于 <code>express.urlencoded</code> 这样的中间件，来解析 <strong><code>POST 提交到服务器的表单数据</code></strong></li>
<li>实现步骤：</li>
</ol>
<ul>
<li>定义中间件</li>
<li>监听 <code>req</code> 的 <code>data</code> 事件</li>
<li>监听 <code>req</code> 的 <code>end</code> 事件</li>
<li>使用 <code>querystring</code> 模块解析请求体数据</li>
<li>将解析出来的数据对象挂载为 <code>req.body</code></li>
<li>将自定义中间件封装为模块</li>
</ul>
<h2 id="14-2-定义中间件"><a href="#14-2-定义中间件" class="headerlink" title="14.2 定义中间件"></a>14.2 定义中间件</h2><ol>
<li>使用 <code>app.use()</code> 来定义全局生效的中间件</li>
<li>代码如下：<br>![](/images/013 - 定义中间件.png)</li>
</ol>
<h2 id="14-3-监听-req-的-data-事件"><a href="#14-3-监听-req-的-data-事件" class="headerlink" title="14.3 监听 req 的 data 事件"></a>14.3 监听 <code>req</code> 的 <code>data</code> 事件</h2><ol>
<li><p>在中间件中，需要监听 <code>req</code> 对象的 <code>data</code> 事件，来获取客户端发送到服务器的数据</p>
</li>
<li><p>如果数据量比较大，无法一次性发送完毕，则客户端会把数据切割后，分批发送到服务器。所以 <code>data</code> 事件可能会触发多次，每一次触发 <code>data</code> 事件时，获取到数据只是完整数据的一部分，需要手动对接收到的数据进行拼接</p>
</li>
<li><p>代码如下：<br>![](/images/014 - 监听 req 的 data 事件.png)</p>
</li>
</ol>
<h2 id="14-4-监听-req-的-end-事件"><a href="#14-4-监听-req-的-end-事件" class="headerlink" title="14.4 监听 req 的 end 事件"></a>14.4 监听 <code>req</code> 的 <code>end</code> 事件</h2><ol>
<li>当请求体数据接收完毕之后，会自动触发 <code>req</code> 的 <code>end</code> 事件</li>
<li>我们可以在 <code>req</code> 的 <code>end</code> 事件中，拿到并处理完整的请求体数据</li>
<li>代码如下：<br>![](/images/015 - 监听 req 的 end 事件.png)</li>
</ol>
<h2 id="14-5-用-querystring-模块解析请求体数据"><a href="#14-5-用-querystring-模块解析请求体数据" class="headerlink" title="14.5 用 querystring 模块解析请求体数据"></a>14.5 用 <code>querystring</code> 模块解析请求体数据</h2><ol>
<li><code>Node.js</code> 内置了一个 <code>querystring</code> 模块，专门用来处理查询字符串。通过这个模块提供的 <code>parse()</code> 函数，可以轻松把查询字符串，解析成对象的格式</li>
<li>代码如下<br>![](/images/016 - 使用 querystring 模块解析请求体数据.png)</li>
</ol>
<h2 id="14-6-将解析出来的数据对象挂载为-req-body"><a href="#14-6-将解析出来的数据对象挂载为-req-body" class="headerlink" title="14.6 将解析出来的数据对象挂载为 req.body"></a>14.6 将解析出来的数据对象挂载为 <code>req.body</code></h2><ol>
<li>**上游的中间件和下游的中间件及路由之间，共享同一份 <code>req</code> 和 <code>res</code>**，因此，我们可以将解析出来的数据，挂载为 <code>req</code> 的自定义属性，命名为 <code>req.body</code>，供下游使用</li>
<li>代码如下<br>![](/images/017 - 将解析出来的数据对象挂载为 req.body.png)</li>
</ol>
<h2 id="14-7-自定义中间件完整代码"><a href="#14-7-自定义中间件完整代码" class="headerlink" title="14.7 自定义中间件完整代码"></a>14.7 自定义中间件完整代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 导入node.js内置模块</span></span><br><span class="line"><span class="keyword">const</span> qs = <span class="built_in">require</span>(<span class="string">&quot;querystring&quot;</span>);</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    自定义中间件，解析post请求体中的数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* 数据是一部分一部分接收到的，接收过程有1个事件data，接收完成有1个事件end*/</span></span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 监听data事件</span></span><br><span class="line">  req.on(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    str += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 监听end事件</span></span><br><span class="line">  req.on(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 把键值对字符串转成对象</span></span><br><span class="line">    <span class="keyword">const</span> body = qs.parse(str);</span><br><span class="line">    <span class="comment">// console.log(body);</span></span><br><span class="line">    <span class="comment">// 把解析后的对象挂载到req.body</span></span><br><span class="line">    req.body = body;</span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line">app.post(<span class="string">&quot;/user&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  res.send(req.body);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;running……&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="15-基于-Express-写接口-○"><a href="#15-基于-Express-写接口-○" class="headerlink" title="15. 基于 Express 写接口 ○"></a>15. 基于 Express 写接口 ○</h1><p>​ ==挂载路由模块化== ==服务器导入路由模块==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%9F%BA%E6%9C%AC%E6%9C%8D%E5%8A%A1%E5%99%A81.png"></p>
<p><strong>效果：</strong></p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%9F%BA%E6%9C%AC%E6%9C%8D%E5%8A%A1%E5%99%A82.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%9F%BA%E6%9C%AC%E6%9C%8D%E5%8A%A1%E5%99%A83.png"></p>
<h1 id="16-cors"><a href="#16-cors" class="headerlink" title="16. cors"></a>16. cors</h1><h2 id="16-1-接口的跨域问题"><a href="#16-1-接口的跨域问题" class="headerlink" title="16.1 接口的跨域问题"></a>16.1 接口的跨域问题</h2><ol>
<li>到目前为止，我们编写的 <code>GET</code> 和 <code>POST</code> 接口，存在一个很严重的问题：<strong>不支持跨域请求</strong></li>
<li>解决接口跨域问题的方案主要有两种</li>
</ol>
<ul>
<li><p><strong>CORS</strong> (主流的解决方案，推荐使用)</p>
</li>
<li><p><strong>JSONP</strong> (有缺陷的解决方案：只支持 GET 请求)</p>
<p>跨域请求：</p>
</li>
</ul>
<p>​ (1) 浏览器有一个同源策略</p>
<p>​ 不允许向跟当前网页地址，非同源的地址发送 ajax 请求</p>
<p>​ (2) 如何判断是否同源</p>
<p>​ 协议，域名，端口号都相同才是同源地址</p>
<p>​ (3) 浏览器请求发出去了</p>
<p>​ 接口服务器也响应了</p>
<p>​ 浏览器拒绝处理响应的内容，并报错</p>
<h2 id="16-2-使用-cors-中间件解决跨域问题"><a href="#16-2-使用-cors-中间件解决跨域问题" class="headerlink" title="16.2 使用 cors 中间件解决跨域问题"></a>16.2 使用 cors 中间件解决跨域问题</h2><ol>
<li>cors 是 Express 的一个第三方中间件。通过安装和配置 cors 中间件，可以很方便地解决跨域问题</li>
<li>使用步骤<ul>
<li>安装中间件： <code>npm install cors</code></li>
<li>导入中间件： <code> const cors = require(&#39;cors&#39;)</code></li>
<li>配置中间件： 在路由之前调用<code> app.use(cors())</code></li>
</ul>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/cors.png"></p>
<h2 id="16-3-cors-请求的分类"><a href="#16-3-cors-请求的分类" class="headerlink" title="16.3 cors 请求的分类"></a>16.3 cors 请求的分类</h2><ol>
<li><p>简单请求</p>
<p>同时满足以下两大条件的请求，就属于简单请求</p>
<ul>
<li><strong>请求方式</strong>：<code>GET</code>、<code>POST</code>、<code>HEAD</code> 三者之一</li>
<li>HTTP 头部信息不超过以下几种字段：<ul>
<li>无自定义头部字段</li>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>DPR</code></li>
<li><code>Downlink</code></li>
<li><code>Save-Data</code></li>
<li><code>Viewport-Width</code></li>
<li><code>Width </code></li>
<li><code>Content-Type</code>（只有三个值 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）</li>
</ul>
</li>
</ul>
</li>
<li><p>预检请求</p>
<ol>
<li>只要符合以下任何一个条件的请求，都需要进行预检请求<ul>
<li>请求方式为 <code>GET</code>、<code>POST</code>、<code>HEAD</code> 之外的请求 <code>Method</code> 类型</li>
<li>请求头中包含自定义头部字段</li>
<li>向服务器发送了 <code>application/json</code> 格式的数据</li>
</ul>
</li>
<li>在浏览器与服务器正式通信之前，浏览器会<strong>先发送 OPTION 请求进行预检，以获知服务器是否允许该实际请求</strong>，所以这一次的 OPTION 请求称为“预检请求”。<strong>服务器成功响应预检请求后，才会发送真正的请求，并且携带真实数据</strong></li>
</ol>
</li>
<li><p>简单请求和预检请求的区别</p>
<ol>
<li>简单请求的特点：客户端与服务器之间<strong>只会发生一次请求</strong></li>
<li>预检请求的特点：客户端与服务器之间<strong>会发生两次请求，OPTION 预检请求成功之后，才会发起真正的请求</strong></li>
</ol>
</li>
</ol>
<h1 id="17-jsonp"><a href="#17-jsonp" class="headerlink" title="17. jsonp"></a>17. jsonp</h1><ol>
<li>概念：浏览器端通过 <code>&lt;script&gt;</code> 标签的 <code>src</code> 属性，请求服务器上的数据，同时，服务器返回一个函数的调用。这种请求数据的方式叫做 <code>JSONP</code></li>
<li>特点</li>
</ol>
<ul>
<li><p><code>JSONP</code> 不属于真正的 <code>Ajax</code> 请求，因为它没有使用 <code>XMLHttpRequest</code> 这个对象</p>
</li>
<li><p><code>JSONP</code> 仅支持 <code>GET</code> 请求，不支持 <code>POST</code>、<code>PUT</code>、<code>DELETE</code> 等请求</p>
<p>3.如果项目中已经配置了 <code>CORS</code> 跨域资源共享，为了防止冲突，必须在配置 <code>CORS</code> 中间件之前声明 <code>JSONP</code> 的接 口，否则 <code>JSONP</code> 接口会被处理成开启了 <code>CORS</code> 的接口</p>
</li>
</ul>
<h2 id="实现-JSONP-接口的步骤"><a href="#实现-JSONP-接口的步骤" class="headerlink" title="实现 JSONP 接口的步骤"></a>实现 <code>JSONP</code> 接口的步骤</h2><p><img src= "/img/loading.gif" data-lazy-src="/images/jsonp1.png"></p>
<h2 id="使用-jQuery-发起-JSONP-请求"><a href="#使用-jQuery-发起-JSONP-请求" class="headerlink" title="使用 jQuery 发起 JSONP 请求"></a>使用 jQuery 发起 JSONP 请求</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          method: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">          url: <span class="string">&quot;http://127.0.0.1:3000/api/jsonp&quot;</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">&quot;jsonp&quot;</span>,</span></span><br><span class="line"><span class="javascript">          success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(res);</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="18-SQL-语句-★"><a href="#18-SQL-语句-★" class="headerlink" title="18. SQL 语句 ★"></a>18. SQL 语句 ★</h1><h2 id="18-1-什么是-SQL"><a href="#18-1-什么是-SQL" class="headerlink" title="18.1 什么是 SQL"></a>18.1 什么是 SQL</h2><ol>
<li><code>SQL</code> 是 <strong>结构化查询语言</strong>，专门用来<strong>访问和处理数据库的编程语言</strong>。能够让我们以编程的形式，操作数据库里面的数据</li>
<li>三个关键点：<ul>
<li><code>SQL</code> 是一门<strong>数据库编程语言</strong></li>
<li>使用 <code>SQL</code> 语言编写出来的代码，叫做 <strong>SQL 语句</strong></li>
<li><code>SQL</code> 语言只能在关系型数据库中使用（例如 <code>MySQL</code>、<code>Oracle</code>、<code>SQL Server</code>）。非关系型数据库（例如 <code>Mongodb</code>）不支持 <code>SQL</code> 语言</li>
</ul>
</li>
</ol>
<h2 id="18-2-SQL-能做什么"><a href="#18-2-SQL-能做什么" class="headerlink" title="18.2 SQL 能做什么"></a>18.2 SQL 能做什么</h2><ol>
<li>从数据库中查询数据</li>
<li>向数据库中插入新的数据</li>
<li>更新数据库中的数据</li>
<li>从数据库删除数据</li>
<li>可以创建新数据库</li>
<li>可在数据库中创建新表</li>
<li>可在数据库中创建存储过程、视图</li>
</ol>
<h2 id="18-3-SQL-的-select-查询语句"><a href="#18-3-SQL-的-select-查询语句" class="headerlink" title="18.3 SQL 的 select 查询语句"></a>18.3 SQL 的 select 查询语句</h2><p>![](/images/009 - SELECT 语句.png)</p>
<ol>
<li><p>查询所有列写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure></li>
<li><p>查询多个列写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username, password <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="18-4-SQL-的-insert-into-插入语句"><a href="#18-4-SQL-的-insert-into-插入语句" class="headerlink" title="18.4 SQL 的 insert into 插入语句"></a>18.4 SQL 的 insert into 插入语句</h2><ol>
<li><p>语法</p>
<p><code>INSERT INTO</code> 语句用于向数据表中插入新的数据行，语法格式如下:<br>![](/images/012 - INSERT INTO 语句.png)</p>
</li>
<li><p>案例代码</p>
</li>
</ol>
<ul>
<li>注意：新的数据需要加上引号，否则会报错</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (username, password) <span class="keyword">values</span> (<span class="string">&#x27;mz&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="18-5-SQL-的-update-修改语句"><a href="#18-5-SQL-的-update-修改语句" class="headerlink" title="18.5 SQL 的 update 修改语句"></a>18.5 SQL 的 update 修改语句</h2><ol>
<li><p>语法</p>
<p><code>Update</code> 语句用于修改表中的数据。语法格式如下<br>![](/images/013 - SQL 的 UPDATE 语句.png)</p>
</li>
<li><p>案例代码</p>
<ul>
<li><strong>多个被更新的列之间， 使用英文的逗号进行分隔</strong></li>
<li><strong>where 后面跟着的是更新的条件</strong></li>
<li><strong>注意： 初学者经常忘记提供更新的 where 条件，这样会导致整张表的数据都被更新，一定要慎重</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users <span class="keyword">set</span> password<span class="operator">=</span><span class="number">654321</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users <span class="keyword">set</span> password<span class="operator">=</span><span class="number">888888</span>, status<span class="operator">=</span><span class="number">1</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">4</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="18-6-SQL-的-delete-删除语句"><a href="#18-6-SQL-的-delete-删除语句" class="headerlink" title="18.6 SQL 的 delete 删除语句"></a>18.6 SQL 的 delete 删除语句</h2><ol>
<li>语法</li>
</ol>
<ul>
<li>DELETE 语句用于删除表中的行<br>![](/images/014 - DELETE 语句用于删除表中的行.png)</li>
</ul>
<ol>
<li>案例代码</li>
</ol>
<ul>
<li><strong>注意： 初学者经常忘记提供更新的 where 条件，这样会导致整张表的数据都被更新，一定要慎重</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> users where id=<span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="18-7-SQL-的-where-子句"><a href="#18-7-SQL-的-where-子句" class="headerlink" title="18.7 SQL 的 where 子句"></a>18.7 SQL 的 where 子句</h2><ol>
<li><p><code>WHERE</code> 子句用于限定选择的标准。在 <code>SELECT</code>、<code>UPDATE</code>、<code>DELETE</code> 语句中，皆可使用 <code>WHERE</code> 子句来限定选择的标准<br>![](/images/015 - WHERE 子句.png)</p>
</li>
<li><p>可在 <code>WHERE</code> 子句中使用的运算符</p>
</li>
</ol>
<ul>
<li>注意：在某些版本的 <code>SQL</code> 中，操作符 <code>&lt;&gt;</code> 可以写为 <code>!=</code><br>![](/images/016 - WHERE 子句.png)</li>
</ul>
<ol>
<li>可以通过 <code>WHERE</code> 子句来限定 <code>SELECT</code> 的查询条件</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 id 为 1 的所有用户</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 id 大于 2 的所有用户</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询 username 不等于 admin 的所有用户</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">&lt;&gt;</span><span class="string">&#x27;zs&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="18-8-SQL-的-and-和-or-运算符"><a href="#18-8-SQL-的-and-和-or-运算符" class="headerlink" title="18.8 SQL 的 and 和 or 运算符"></a>18.8 SQL 的 and 和 or 运算符</h2><ol>
<li><code>AND</code> 和 <code>OR</code> 可在 <code>WHERE</code> 子语句中把两个或多个条件结合起来</li>
<li><code>AND</code> 表示必须同时满足多个条件，相当于 <code>JavaScript</code> 中的 <code>&amp;&amp;</code> 运算符，例如 <code>if (a !== 10 &amp;&amp; a !== 20)</code></li>
<li><code>OR</code> 表示只要满足任意一个条件即可，相当于 <code>JavaScript</code> 中的 <code>||</code> 运算符，例如 <code>if(a !== 10 || a !== 20)</code></li>
<li>案例代码</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- and</span></span><br><span class="line"><span class="comment">-- 使用 AND 来显示所有 status 为 0，并且 id 小于 3 的用户</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> status<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- or</span></span><br><span class="line"><span class="comment">-- 使用 OR 来显示所有 status 为 1，或者 username 为 zs 的用户</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> status<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> username<span class="operator">=</span><span class="string">&#x27;zs&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="18-9-SQL-的-order-by-子句"><a href="#18-9-SQL-的-order-by-子句" class="headerlink" title="18.9 SQL 的 order by 子句"></a>18.9 SQL 的 order by 子句</h2><ol>
<li>语法</li>
</ol>
<ul>
<li><code>ORDER BY</code> 语句用于根据指定的列对结果集进行排序</li>
<li><code>ORDER BY</code> 语句默认按照升序对记录进行排序，<code>ASC</code> 关键字代表升序排序</li>
<li>如果您希望按照降序对记录进行排序，可以使用 <code>DESC</code> 关键字</li>
</ul>
<ol>
<li><p><strong><code>ORDER BY</code> 子句 - 升序排序</strong></p>
<p>对 <code>users</code> 表中的数据，按照 <code>status</code> 字段进行升序排序</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面这两条 SQL 语句是等价的，</span></span><br><span class="line"><span class="comment">-- 因为 order by 默认进行升序排序</span></span><br><span class="line"><span class="comment">-- 其中，ASC 关键字代表升序排序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- select * from users order by status</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">order</span> <span class="keyword">by</span> status <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong><code>ORDER BY</code> 子句 – 降序排序</strong></p>
<p>对 users 表中的数据，按照 id 字段进行降序排序</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- desc 代表降序排序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">order</span> <span class="keyword">by</span> status <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<h2 id="18-10-order-by-子句-–-多重排序"><a href="#18-10-order-by-子句-–-多重排序" class="headerlink" title="18.10 order by 子句 – 多重排序"></a>18.10 order by 子句 – 多重排序</h2><ol>
<li>对 <code>users</code> 表中的数据，先按照 <code>status</code> 字段进行降序排序，再按照 <code>username</code> 的字母顺序，进行升序排序</li>
<li>案例代码</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">order</span> <span class="keyword">by</span> status <span class="keyword">desc</span>, username <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

<h2 id="18-11-SQL-count-函数"><a href="#18-11-SQL-count-函数" class="headerlink" title="18.11 SQL count(*) 函数"></a>18.11 SQL count(*) 函数</h2><ol>
<li><p><code>COUNT(*)</code> 函数用于返回查询结果的总数据条数<br><img src= "/img/loading.gif" data-lazy-src="/images/017-count.png"></p>
</li>
<li><p>案例语法</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 users 表中 status 为 0 的总数据条数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> users wheres status<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="18-12-使用-as-为列设置别名"><a href="#18-12-使用-as-为列设置别名" class="headerlink" title="18.12 使用 as 为列设置别名"></a>18.12 使用 as 为列设置别名</h2><p>如果希望给查询出来的列名称设置别名，可以使用 <code>AS</code> 关键字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将列名从 count(*) 修改为 total</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> users <span class="keyword">where</span> status<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将列名 username 改为 uname， password 改为 upwd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> username <span class="keyword">as</span> uname, password <span class="keyword">as</span> upwd <span class="keyword">from</span> users</span><br></pre></td></tr></table></figure>

<h1 id="19-js-代码操作-MySQL-模块"><a href="#19-js-代码操作-MySQL-模块" class="headerlink" title="19. js 代码操作 MySQL 模块"></a>19. js 代码操作 MySQL 模块</h1><h2 id="19-1-操作步骤"><a href="#19-1-操作步骤" class="headerlink" title="19.1 操作步骤"></a>19.1 操作步骤</h2><ol>
<li><p>安装 mysql 模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql</span><br></pre></td></tr></table></figure></li>
<li><p>配置 mysql 模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入mysql包</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>);</span><br><span class="line"><span class="comment">// 创建链接对象</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.createPool(&#123;</span><br><span class="line">  host: <span class="string">&quot;127.0.0.1&quot;</span>, <span class="comment">// 指定数据库所在电脑的ip</span></span><br><span class="line">  user: <span class="string">&quot;root&quot;</span>, <span class="comment">// 用户名</span></span><br><span class="line">  password: <span class="string">&quot;&quot;</span>, <span class="comment">// 密码</span></span><br><span class="line">  database: <span class="string">&quot;my_db_01&quot;</span>, <span class="comment">// 数据库名字</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>测试 mysql 模块能否正常工作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试是否连接成功</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">&quot;select * from users&quot;</span>;</span><br><span class="line">db.query(sql, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 成功 err null results 结果</span></span><br><span class="line">  <span class="comment">// 失败 err 错误对象</span></span><br><span class="line">  <span class="comment">// console.log(err);</span></span><br><span class="line">  <span class="comment">// console.log(err.message);</span></span><br><span class="line">  <span class="comment">// console.log(results);</span></span><br><span class="line">  <span class="comment">// 判断是否执行成功</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(err.message);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>整体效果：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/js%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93.png"></p>
<h2 id="19-2-写基本的接口"><a href="#19-2-写基本的接口" class="headerlink" title="19.2 写基本的接口"></a>19.2 写基本的接口</h2><h3 id="一、创一个服务器"><a href="#一、创一个服务器" class="headerlink" title="一、创一个服务器"></a>一、创一个服务器</h3><p>​ 1、引入 express 包</p>
<p>​ 2、导入 express</p>
<p>​ 3、创建服务器</p>
<p>​ 4、开启服务器</p>
<p>​ 5、设置全局中间件（解析 post 请求中的数据）</p>
<p>​ 6、导入路由模块</p>
<p>7、注册路由模块对象</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/code%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E5%9D%97.png"></p>
<h3 id="二、单独设置路由模块"><a href="#二、单独设置路由模块" class="headerlink" title="二、单独设置路由模块"></a>二、单独设置路由模块</h3><p>​ 1、导入 express</p>
<p>​ 2、创建路由对象</p>
<p>​ 3、导入路由处理函数对应的模块</p>
<p>​ 4、拦截路由</p>
<p>​ 5、暴露出去路由</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/code%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97.png"></p>
<h3 id="三、单独模块来写路由处理函数"><a href="#三、单独模块来写路由处理函数" class="headerlink" title="三、单独模块来写路由处理函数"></a>三、单独模块来写路由处理函数</h3><p>​ 1、注册路由处理函数</p>
<p>​ 1-获取用户的数据是否合法</p>
<p>​ 2-把数据添加到数据库中</p>
<p>​ 判断是否添加成功</p>
<p>​ 2、登录的处理函数</p>
<p>​ 1-获取用户提交的数据</p>
<p>​ 2-验证数据的合法性</p>
<p>​ 3-验证用户是否存在</p>
<p>​ 4-判断用户是否存在（查询到的数组不能是空数组）</p>
<p>​ 5-判断密码是否正确</p>
<p>​ 3、获取用户列表的处理函数</p>
<p>​ 4、导入数据库中的数据</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/code%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%A8%A1%E5%9D%97.png"></p>
<h3 id="四、单独一个模块来写数据库"><a href="#四、单独一个模块来写数据库" class="headerlink" title="四、单独一个模块来写数据库"></a>四、单独一个模块来写数据库</h3><p>​ 1、创建 mysql</p>
<p>​ 2、导入 sql</p>
<p>​ 3、暴露出去 db</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/code%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9D%97.png"></p>
<h1 id="20-session"><a href="#20-session" class="headerlink" title="20. session"></a>20. session</h1><h2 id="20-1-什么是-cookie"><a href="#20-1-什么是-cookie" class="headerlink" title="20.1 什么是 cookie"></a>20.1 什么是 cookie</h2><ol>
<li><code>Cookie</code> 是存储在用户浏览器中的一段不超过 4 KB 的字符串。它由一个名称（Name）、一个值（Value）和其它几个用于控制 Cookie <strong>有效期</strong>、<strong>安全性</strong>、<strong>使用范围</strong>的<strong>可选属性</strong>组成</li>
<li>不同域名下的 Cookie 各自独立，每当客户端发起请求时，会<strong>自动</strong>把<strong>当前域名下</strong>所有<strong>未过期的 Cookie</strong> 一同发送到服务器</li>
<li><code>Cookie</code> 的几大特性</li>
</ol>
<ul>
<li>自动发送</li>
<li>域名独立</li>
<li>过期时限</li>
<li>4KB 限制</li>
</ul>
<h2 id="20-2-安装-express-session-中间件"><a href="#20-2-安装-express-session-中间件" class="headerlink" title="20.2 安装 express-session 中间件"></a>20.2 安装 express-session 中间件</h2><ol>
<li><p>安装 <code>express-session</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-session --save</span><br></pre></td></tr></table></figure></li>
<li><p>导入 <code>session</code> 中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>配置 <code>express-session</code> 中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    secret: <span class="string">&quot;小白白~_~&quot;</span>,</span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="20-3-向-session-中存数据"><a href="#20-3-向-session-中存数据" class="headerlink" title="20.3 向 session 中存数据"></a>20.3 向 session 中存数据</h2><ol>
<li><p>当 <code>express-session</code> 中间件配置成功后，即可通过 <code>req.session</code> 来访问和使用 <code>session</code> 对象，从而存储用户的关键信息</p>
</li>
<li><p>实例：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/session.png"></p>
</li>
</ol>
<p>3.</p>
<h2 id="20-4-从-session-中取数据"><a href="#20-4-从-session-中取数据" class="headerlink" title="20.4 从 session 中取数据"></a>20.4 从 session 中取数据</h2><ol>
<li>可以直接从 <code>req.session</code> 对象上获取之前存储的数据</li>
<li>实例<img src= "/img/loading.gif" data-lazy-src="/images/session2.png"></li>
</ol>
<h2 id="20-5-清空-session"><a href="#20-5-清空-session" class="headerlink" title="20.5 清空 session"></a>20.5 清空 session</h2><ol>
<li>调用 <code>req.session.destroy()</code> 函数，即可清空服务器保存的 <code>session</code> 信息</li>
<li>实例配置 cors 跨域和解析表单数据的中间件<img src= "/img/loading.gif" data-lazy-src="/images/session3.png"></li>
</ol>
<h1 id="21-jwt"><a href="#21-jwt" class="headerlink" title="21. jwt"></a>21. jwt</h1><h2 id="21-1-JWT-的工作原理"><a href="#21-1-JWT-的工作原理" class="headerlink" title="21.1 JWT 的工作原理"></a>21.1 JWT 的工作原理</h2><ol>
<li>用户的信息通过 <code>Token</code> 字符串的形式，保存在客户端浏览器中</li>
<li>服务器通过还原 <code>Token</code> 字符串的形式来认证用户的身份<br>![](/images/012 - JWT 的工作原理.png)</li>
</ol>
<h2 id="21-2-JWT-的组成部分"><a href="#21-2-JWT-的组成部分" class="headerlink" title="21.2 JWT 的组成部分"></a>21.2 JWT 的组成部分</h2><ol>
<li><code>JWT</code> 通常由三部分组成，分别是 <code>Header</code>（头部）、<code>Payload</code>（有效荷载）、<code>Signature</code>（签名）</li>
<li>三者之间使用英文的“.”分隔</li>
</ol>
<ul>
<li><p><code>Payload</code> 部分才是真正的用户信息，它是用户信息经过加密之后生成的字符串</p>
</li>
<li><p><code>Header</code> 和 <code>Signature</code> 是安全性相关的部分，只是为了保证 <code>Token</code> 的安全性</p>
</li>
</ul>
<h2 id="21-3-JWT-安装"><a href="#21-3-JWT-安装" class="headerlink" title="21.3 JWT 安装"></a>21.3 JWT 安装</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jsonwebtoken express-jwt</span><br></pre></td></tr></table></figure>

<h2 id="21-4-导入-JWT"><a href="#21-4-导入-JWT" class="headerlink" title="21.4 导入 JWT"></a>21.4 导入 JWT</h2><p><img src= "/img/loading.gif" data-lazy-src="/images/jwt1.png"></p>
<h2 id="21-5-定义-secret-密钥"><a href="#21-5-定义-secret-密钥" class="headerlink" title="21.5 定义 secret 密钥"></a>21.5 定义 secret 密钥</h2><p>​ 为了保证 <code>JWT</code>字符串的安全性，防止 JWT 字符串在网络传输过程中被别人破解，我们需要专门定义一个用于加密和解密的 <code>secret</code> 密钥</p>
<ul>
<li>当生成 <code>JWT</code> 字符串的时候，需要使用 <code>secret</code> 密钥对用户信息进行加密，最终得到加密好的 JWT 字符串</li>
<li>当把 <code>JWT</code> 字符串解析还原成 <code>JSON</code> 对象的时候，需要使用 <code>secret</code> 密钥进行解密</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="/images/jwt2.png"></p>
<h2 id="21-6-在登录成功后生成-JWT-字符串"><a href="#21-6-在登录成功后生成-JWT-字符串" class="headerlink" title="21.6 在登录成功后生成 JWT 字符串"></a>21.6 在登录成功后生成 JWT 字符串</h2><p>调用 <code>jsonwebtoken</code> 包提供的 <code>sign()</code> 方法，将用户的信息加密成 <code>JWT</code> 字符串，响应给客户端</p>
<p>示例：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/jwt3.png"></p>
<h2 id="21-7-将-JWT-字符串还原为-JSON-对象"><a href="#21-7-将-JWT-字符串还原为-JSON-对象" class="headerlink" title="21.7 将 JWT 字符串还原为 JSON 对象"></a>21.7 将 JWT 字符串还原为 JSON 对象</h2><ol>
<li><p>客户端每次在访问那些有权限接口的时候，都需要主动通过请求头中的 <code>Authorization</code> 字段，将 <code>Token</code> 字符串发送到服务器进行身份认证</p>
</li>
<li><p>此时，服务器可以通过 <code>express-jwt</code> 这个中间件，自动将客户端发送过来的 <code>Token</code> 解析还原成 <code>JSON</code> 对象</p>
</li>
<li><p>示例</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/jwt4.png"></p>
</li>
</ol>
<h2 id="21-8-使用-req-user-获取用户信息"><a href="#21-8-使用-req-user-获取用户信息" class="headerlink" title="21.8 使用 req.user 获取用户信息"></a>21.8 使用 req.user 获取用户信息</h2><ol>
<li><p>当 <code>express-jwt</code> 这个中间件配置成功之后，即可在那些有权限的接口中，使用 <code>req.user</code> 对象，来访问从 <code>JWT</code> 字符串中解析出来的用户信息了</p>
</li>
<li><p>实例</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/jwt5.png"></p>
</li>
</ol>
<h2 id="21-9-捕获解析-JWT-失败后产生的错误"><a href="#21-9-捕获解析-JWT-失败后产生的错误" class="headerlink" title="21.9 捕获解析 JWT 失败后产生的错误"></a>21.9 捕获解析 JWT 失败后产生的错误</h2><ol>
<li><p>当使用 <code>express-jwt</code> 解析 <code>Token</code> 字符串时，如果客户端发送过来的 <code>Token</code> 字符串过期或不合法，会产生一个解析失败的错误，影响项目的正常运行</p>
</li>
<li><p>可以通过 <code>Express</code> 的错误中间件，捕获这个错误并进行相关的处理</p>
</li>
<li><p>示例</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/jwt6.png"></p>
</li>
</ol>
<h1 id="22-大事件项目-api-server"><a href="#22-大事件项目-api-server" class="headerlink" title="22. 大事件项目 api_server"></a>22. 大事件项目 api_server</h1><h2 id="22-1-初始化"><a href="#22-1-初始化" class="headerlink" title="22.1 初始化"></a>22.1 初始化</h2><h3 id="22-1-1-创建项目"><a href="#22-1-1-创建项目" class="headerlink" title="22.1.1 创建项目"></a>22.1.1 创建项目</h3><ol>
<li><p>新建 <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure></li>
<li><p>运行如下的命令，安装特定版本的 <code>express</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express@4.17.1</span><br></pre></td></tr></table></figure></li>
<li><p>在项目根目录中新建 <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里你想写啥就写啥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">3007</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;呀，傻der来看你的服务器启动成功了吗&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="22-1-2-配置-cors-跨域"><a href="#22-1-2-配置-cors-跨域" class="headerlink" title="22.1.2 配置 cors 跨域"></a>22.1.2 配置 cors 跨域</h3><ol>
<li><p>运行如下的命令，安装 <code>cors</code> 中间件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cors</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>app.js</code> 中导入并配置 <code>cors</code> 中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 cors 中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"><span class="comment">// 解决跨域请求的中间件</span></span><br><span class="line">app.use(cors());</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="22-1-3-配置解析表单数据的中间件"><a href="#22-1-3-配置解析表单数据的中间件" class="headerlink" title="22.1.3 配置解析表单数据的中间件"></a>22.1.3 配置解析表单数据的中间件</h3><p>通过如下的代码，配置解析 <code>application/x-www-form-urlencoded</code> 格式的表单数据的中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3-解析post请求的中间件</span></span><br><span class="line">app.use(</span><br><span class="line">  express.urlencoded(&#123;</span><br><span class="line">    extended: <span class="literal">false</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="22-1-4-初始化路由模块"><a href="#22-1-4-初始化路由模块" class="headerlink" title="22.1.4 初始化路由模块"></a>22.1.4 初始化路由模块</h3><blockquote>
<p>路由模块中，只存放客户端的请求与处理函数之间的映射关系</p>
</blockquote>
<ol>
<li><p>在项目根目录中，新建 <code>router</code> 文件夹，在 router 文件夹下创建<code>userRouter.js</code>文件用来存放所有的路由模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册路由</span></span><br><span class="line">router.post(<span class="string">&quot;/reguser&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;reguser ok&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录路由</span></span><br><span class="line">router.post(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;login ok&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露出去路由对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>app.js</code> 中，导入并使用 <code>用户路由模块</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入并注册用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&quot;./router/userRouter&quot;</span>);</span><br><span class="line">app.use(<span class="string">&quot;/api&quot;</span>, userRouter);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="22-1-5-抽离用户路由模块中的处理函数"><a href="#22-1-5-抽离用户路由模块中的处理函数" class="headerlink" title="22.1.5 抽离用户路由模块中的处理函数"></a>22.1.5 抽离用户路由模块中的处理函数</h3><blockquote>
<p>路由处理函数模块中，专门负责存放每个路由对应的处理函数</p>
</blockquote>
<ol>
<li><p>在项目根目录中，新建 <code>router_Handler</code> 文件夹，在 router_Handler 文件夹下创建<code>userHandler.js</code>文件用来存放所有的路由处理函数模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.reguser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;reguser OK&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.login = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;login OK&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>将 <code>/router/userRouter.js</code> 中的代码修改为如下结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&quot;../router_Handler/userHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&quot;/reguser&quot;</span>, userHandler.reguser);</span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.post(<span class="string">&quot;/login&quot;</span>, userHandler.login);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="22-2-登录注册"><a href="#22-2-登录注册" class="headerlink" title="22.2 登录注册"></a>22.2 登录注册</h2><h3 id="22-2-1-新建数据库"><a href="#22-2-1-新建数据库" class="headerlink" title="22.2.1 新建数据库"></a>22.2.1 新建数据库</h3><p>在<code>db_xbb</code> 数据库中新建 <code>ev_users</code> 表</p>
<h3 id="22-2-2-安装并配置-mysql-模块"><a href="#22-2-2-安装并配置-mysql-模块" class="headerlink" title="22.2.2 安装并配置 mysql 模块"></a>22.2.2 安装并配置 mysql 模块</h3><ol>
<li><p>安装 mysql 模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql</span><br></pre></td></tr></table></figure></li>
<li><p>在项目根目录中新建个 <code>db</code> 文件夹，在<code>db</code> 文件夹下新建<code>db.js</code>文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/db.png"></p>
</li>
</ol>
<h3 id="22-3-注册"><a href="#22-3-注册" class="headerlink" title="22.3 注册"></a>22.3 注册</h3><h4 id="22-3-1-实现的步骤"><a href="#22-3-1-实现的步骤" class="headerlink" title="22.3.1 实现的步骤"></a>22.3.1 实现的步骤</h4><ol>
<li><p>检测表单数据是否合法</p>
</li>
<li><p>检测用户名是否被占用</p>
</li>
<li><p>对密码进行加密处理</p>
</li>
<li><p>插入新用户 ​</p>
</li>
</ol>
<h4 id="22-3-2-检测表单数据是否合法"><a href="#22-3-2-检测表单数据是否合法" class="headerlink" title="22.3.2 检测表单数据是否合法"></a>22.3.2 检测表单数据是否合法</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%B3%A8%E5%86%8C1.png"></p>
<h4 id="22-3-3-检测用户名是否被占用"><a href="#22-3-3-检测用户名是否被占用" class="headerlink" title="22.3.3 检测用户名是否被占用"></a>22.3.3 检测用户名是否被占用</h4><ol>
<li><p>在 <code>userHandler.js</code> 路由处理函数模块中导入 <code>db.js</code> 模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&quot;../db/db&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>执行 sql 语句来判断</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%B3%A8%E5%86%8C2.png"></p>
</li>
</ol>
<h4 id="22-3-4-对密码进行加密处理"><a href="#22-3-4-对密码进行加密处理" class="headerlink" title="22.3.4 对密码进行加密处理"></a>22.3.4 对密码进行加密处理</h4><ol>
<li><p>安装<code>bcryptjs</code> 包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bcryptjs</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>userHandler.js</code> 路由处理函数模块中导入 <code>bcryptjs</code> 包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入加密对象</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&quot;bcryptjs&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>在注册用户的处理函数中，确认用户名可用之后，调用 <code>bcrypt.hashSync(明文密码, 随机盐的长度)</code> 方法，对用户的密码进行加密处理</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%8A%A0%E5%AF%86.png"></p>
</li>
</ol>
<h4 id="22-3-5-添加新用户"><a href="#22-3-5-添加新用户" class="headerlink" title="22.3.5 添加新用户"></a>22.3.5 添加新用户</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93.png"></p>
<h3 id="22-4-优化-res-send"><a href="#22-4-优化-res-send" class="headerlink" title="22.4 优化 res.send()"></a>22.4 优化 res.send()</h3><blockquote>
<p>在处理函数中，需要多次调用 <code>res.send()</code> 向客户端响应 <code>处理失败</code> 的结果，为了简化代码，可以手动封装一个 res.cc() 函数</p>
</blockquote>
<p>在 <code>app.js</code> 中，所有路由之前，声明一个全局中间件，为 res 对象挂载一个 <code>res.cc()</code> 函数</p>
<p>![](&lt;/&lt;images/优化 res.send().png&gt;&gt;)</p>
<h3 id="22-5-优化表单数据验证"><a href="#22-5-优化表单数据验证" class="headerlink" title="22.5 优化表单数据验证"></a>22.5 优化表单数据验证</h3><blockquote>
<p>解决 if…else 语句效率低，不易维护的问题</p>
</blockquote>
<ol>
<li><p>安装 <code>@hapi/joi</code> 包，为表单中携带的每个数据项，定义验证规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @hapi/joi@17.1.0</span><br></pre></td></tr></table></figure></li>
<li><p>安装 <code>@escook/express-joi</code> 中间件，来实现自动对表单数据进行验证的功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @escook/express-joi</span><br></pre></td></tr></table></figure></li>
<li><p>新建 <code>/schema/userSchema.js</code> 用户信息验证规则模块</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81.png"></p>
</li>
<li><p>修改 <code>/router/userRouter.js</code> 中的代码</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
</li>
<li><p>在 <code>app.js</code> 的全局错误级别中间件中，捕获验证失败的错误，并把验证失败的结果响应给客户端</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/111.png"></p>
<h3 id="22-6-登录"><a href="#22-6-登录" class="headerlink" title="22.6 登录"></a>22.6 登录</h3><h4 id="22-6-1-检验登录表单是否合法"><a href="#22-6-1-检验登录表单是否合法" class="headerlink" title="22.6.1 检验登录表单是否合法"></a>22.6.1 检验登录表单是否合法</h4><p>修改<code>router/userRouter.js</code> 登录路由，加上局部中间件，来进行验证</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E7%99%BB%E5%BD%95%E6%8C%82%E8%BD%BD%E8%B7%AF%E7%94%B1.png"></p>
<h4 id="22-6-2-安装生成-Token-字符串的包"><a href="#22-6-2-安装生成-Token-字符串的包" class="headerlink" title="22.6.2 安装生成 Token 字符串的包"></a>22.6.2 安装生成 Token 字符串的包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jsonwebtoken</span><br></pre></td></tr></table></figure>

<h4 id="22-6-3-导入-jsonwebtoken-包"><a href="#22-6-3-导入-jsonwebtoken-包" class="headerlink" title="22.6.3 导入 jsonwebtoken 包"></a>22.6.3 导入 <code>jsonwebtoken</code> 包</h4><p>在路由处理函数模块 <code>router_Handler/userHandler.js</code> 中添加</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E5%8A%A0%E5%AF%86token%E5%8C%85.png"></p>
<h4 id="22-6-4-在根目录下创建-config-js-文件"><a href="#22-6-4-在根目录下创建-config-js-文件" class="headerlink" title="22.6.4 在根目录下创建 config.js 文件"></a>22.6.4 在根目录下创建 config.js 文件</h4><p>创建 <code>config.js</code> 文件，并向外共享 <strong>加密</strong> 和 <strong>还原</strong> Token 的 <code>jwtSecretKey</code> 字符串</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/config.png"></p>
<h4 id="22-6-5-这一步关键呦"><a href="#22-6-5-这一步关键呦" class="headerlink" title="22.6.5 这一步关键呦"></a>22.6.5 这一步关键呦</h4><ol>
<li>==接收客户端提交的数据==</li>
<li>==判断用户是否存在==</li>
<li>==判断密码是否正确==</li>
<li>==把用户信息生成 token 字符串==</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E7%99%BB%E5%BD%95%E8%B7%AF%E7%94%B1%E5%87%BD%E6%95%B0.png"></p>
<h4 id="22-6-6-配置解析-token-的中间件"><a href="#22-6-6-配置解析-token-的中间件" class="headerlink" title="22.6.6 配置解析 token 的中间件"></a>22.6.6 配置解析 token 的中间件</h4><h5 id="1-安装解析-token-的中间件"><a href="#1-安装解析-token-的中间件" class="headerlink" title="1. 安装解析 token 的中间件"></a>1. 安装解析 token 的中间件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-jwt</span><br></pre></td></tr></table></figure>

<h5 id="2-在-app-js-中注册路由之前，配置解析-Token-的中间件"><a href="#2-在-app-js-中注册路由之前，配置解析-Token-的中间件" class="headerlink" title="2. 在 app.js 中注册路由之前，配置解析 Token 的中间件"></a>2. 在 <code>app.js</code> 中注册路由之前，配置解析 Token 的中间件</h5><p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%A7%A3%E6%9E%90token%E5%AD%97%E7%AC%A6%E4%B8%B2.png"></p>
<h5 id="3-在-app-js-中的-错误级别中间件-里面，捕获并处理-Token-认证失败后的错误"><a href="#3-在-app-js-中的-错误级别中间件-里面，捕获并处理-Token-认证失败后的错误" class="headerlink" title="3. 在 app.js 中的 错误级别中间件 里面，捕获并处理 Token 认证失败后的错误"></a>3. 在 <code>app.js</code> 中的 <code>错误级别中间件</code> 里面，捕获并处理 Token 认证失败后的错误</h5><p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%A7%A3%E6%9E%90token%E9%94%99%E8%AF%AF%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
<h2 id="22-3-个人中心"><a href="#22-3-个人中心" class="headerlink" title="22.3 个人中心"></a>22.3 个人中心</h2><p>1-==创建 <code>router/userinfoHandler.js</code> 路由模块文件==</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// 导入路由处理函数</span></span><br><span class="line"><span class="keyword">const</span> userinfoHandler = <span class="built_in">require</span>(<span class="string">&quot;../routerHandler/userinfoHandler&quot;</span>);</span><br><span class="line"><span class="comment">// 拦截路由</span></span><br><span class="line">router.get(<span class="string">&quot;/userinfo&quot;</span>, userinfoHandler.getUserinfo);</span><br><span class="line"><span class="comment">// 暴露出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>2-==创建 <code>route_Handler/userinfoHandler.js</code> 路由处理函数模块文件==</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.getUserInfo = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>3-==在 <code>app.js</code> 中导入路由模块==</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* --------导入路由模块对象并注册-------------- */</span></span><br><span class="line"><span class="keyword">const</span> userinfoRouter = <span class="built_in">require</span>(<span class="string">&quot;./router/userinfoRouter&quot;</span>);</span><br><span class="line">app.use(<span class="string">&quot;/my&quot;</span>, userinfoRouter);</span><br></pre></td></tr></table></figure>

<h3 id="22-3-1-获取用户信息"><a href="#22-3-1-获取用户信息" class="headerlink" title="22.3.1 获取用户信息"></a>22.3.1 获取用户信息</h3><ol>
<li>在<code>route_Handler/userinfoHandler.js</code>导入数据库</li>
<li>用户登录成功后会解析 token ，req 中会多一个 user 属性</li>
<li>定义 sql 语句并执行，判断 sql 语句是否执行成功</li>
<li>判断用户信息是否存在</li>
<li>拿到用户信息</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93.png"><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF.png"></p>
<h3 id="22-3-2-更新用户信息"><a href="#22-3-2-更新用户信息" class="headerlink" title="22.3.2 更新用户信息"></a>22.3.2 更新用户信息</h3><h4 id="1-定义更新路由和路由处理函数模块"><a href="#1-定义更新路由和路由处理函数模块" class="headerlink" title="1-定义更新路由和路由处理函数模块"></a>1-定义更新路由和路由处理函数模块</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户信息的路由</span></span><br><span class="line">router.post(<span class="string">&quot;/userinfo&quot;</span>, userinfo_handler.updateUserInfo);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.updateUserInfo = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-验证表单数据"><a href="#2-验证表单数据" class="headerlink" title="2- 验证表单数据"></a>2- 验证表单数据</h4><ol>
<li><p>在<code>schema/userSchema.js</code> ==定义 id、nickname、email 验证规则==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%991.png"></p>
</li>
<li><p>==将验证规则暴露出去==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%992.png"></p>
</li>
<li><p>在 <code>router/userinfoRouter.js</code> ==导入验证数据合法性的中间件和验证规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
</li>
<li><p>修改<code>router/userinfoRouter.js</code> 中的更新用户信息的路由，==写入局部中间件==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E8%B7%AF%E7%94%B1.png"></p>
</li>
</ol>
<h4 id="3-实现的基本功能"><a href="#3-实现的基本功能" class="headerlink" title="3- 实现的基本功能"></a>3- 实现的基本功能</h4><ol>
<li>接收客户端发送的数据</li>
<li>定义并执行 sql 语句</li>
<li>判断用户信息是否修改成功</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-3-3-重置密码"><a href="#22-3-3-重置密码" class="headerlink" title="22.3.3 重置密码"></a>22.3.3 重置密码</h3><h4 id="1-定义重置密码的路由和路由处理函数模块"><a href="#1-定义重置密码的路由和路由处理函数模块" class="headerlink" title="1- 定义重置密码的路由和路由处理函数模块"></a>1- 定义重置密码的路由和路由处理函数模块</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的路由</span></span><br><span class="line">router.post(<span class="string">&quot;/updatepwd&quot;</span>, userinfo_handler.updatePassword);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重置密码的路由处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.updatePwd = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-验证表单数据-1"><a href="#2-验证表单数据-1" class="headerlink" title="2- 验证表单数据"></a>2- 验证表单数据</h4><blockquote>
<p>旧密码与新密码，必须符合密码的验证规则，并且新密码不能与旧密码一致！</p>
</blockquote>
<ol>
<li><p>在 <code>/schema/userSchema.js</code> 模块中==定义重置密码的验证规则==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99.png"></p>
</li>
<li><p>将 <code>/schema/userSchema.js</code> 模块中的==验证规则对象暴露出去==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1.png"></p>
</li>
<li><p>在 <code>router/userinfoRouter.js</code> ==导入验证数据合法性的中间件和验证规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
</li>
<li><p>修改<code>router/userinfoRouter.js</code> 中的重置密码的路由，==写入局部中间件==</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E8%B7%AF%E7%94%B1.png"></p>
<h4 id="3-实现重置密码的功能"><a href="#3-实现重置密码的功能" class="headerlink" title="3- 实现重置密码的功能"></a>3- 实现重置密码的功能</h4><ol>
<li>接收客户端发送的数据</li>
<li>根据 id 查询当前用户是否存在</li>
<li>导入加密密码的包</li>
<li>验证旧密码是否一致</li>
<li>对新密码进行加密处理并修改</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E5%AF%BC%E5%85%A5%E5%8A%A0%E5%AF%86%E5%8C%85.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-3-4-更新用户头像"><a href="#22-3-4-更新用户头像" class="headerlink" title="22.3.4 更新用户头像"></a>22.3.4 更新用户头像</h3><h4 id="1-定义更新头像路由和路由处理函数模块"><a href="#1-定义更新头像路由和路由处理函数模块" class="headerlink" title="1-定义更新头像路由和路由处理函数模块"></a>1-定义更新头像路由和路由处理函数模块</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户信息的路由</span></span><br><span class="line">router.post(<span class="string">&quot;/update/avatar&quot;</span>, userinfo_handler.updateAvatar);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户基本信息的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.updateAvatar = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-验证表单数据-2"><a href="#2-验证表单数据-2" class="headerlink" title="2- 验证表单数据"></a>2- 验证表单数据</h4><ol>
<li><p>在<code>schema/userSchema.js</code> ==定义头像验证规则==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99.png"></p>
</li>
<li><p>==将验证规则暴露出去==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1.png"></p>
</li>
<li><p>在 <code>router/userinfoRouter.js</code> ==导入验证数据合法性的中间件和验证规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E7%9A%84%E9%AA%8C%E8%AF%81%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
</li>
<li><p>修改<code>router/userinfoRouter.js</code> 中的更新用户信息的路由，==写入局部中间件==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E7%9A%84%E8%B7%AF%E7%94%B1.png"></p>
</li>
</ol>
<h4 id="3-实现的基本功能-1"><a href="#3-实现的基本功能-1" class="headerlink" title="3- 实现的基本功能"></a>3- 实现的基本功能</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h2 id="22-4-文章分类管理"><a href="#22-4-文章分类管理" class="headerlink" title="22.4 文章分类管理"></a>22.4 文章分类管理</h2><h3 id="22-4-1-新建-ev-article-cate-表"><a href="#22-4-1-新建-ev-article-cate-表" class="headerlink" title="22.4.1 新建 ev_article_cate 表"></a>22.4.1 新建 ev_article_cate 表</h3><h3 id="22-4-2-获取文章分类列表"><a href="#22-4-2-获取文章分类列表" class="headerlink" title="22.4.2 获取文章分类列表"></a>22.4.2 获取文章分类列表</h3><h4 id="1-初始化新建-router-articleRouter-js路由模块"><a href="#1-初始化新建-router-articleRouter-js路由模块" class="headerlink" title="1- 初始化新建 router/articleRouter.js路由模块"></a>1- 初始化新建 <code>router/articleRouter.js</code>路由模块</h4><p>​ 新创建个 <code>router/articleRouter.js</code> 路由模块</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8.png"></p>
<h4 id="2-初始化新建router-Handler-artcateHandler-js-路由处理函数模块"><a href="#2-初始化新建router-Handler-artcateHandler-js-路由处理函数模块" class="headerlink" title="2- 初始化新建router_Handler/artcateHandler.js 路由处理函数模块"></a>2- 初始化新建<code>router_Handler/artcateHandler.js</code> 路由处理函数模块</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h4 id="3-在-app-js-中导入路由模块"><a href="#3-在-app-js-中导入路由模块" class="headerlink" title="3- 在 app.js 中导入路由模块"></a>3- 在 <code>app.js</code> 中导入路由模块</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97.png"></p>
<h4 id="4-获取文章列表操作"><a href="#4-获取文章列表操作" class="headerlink" title="4- 获取文章列表操作"></a>4- 获取文章列表操作</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-4-3-新增文章分类"><a href="#22-4-3-新增文章分类" class="headerlink" title="22.4.3 新增文章分类"></a>22.4.3 新增文章分类</h3><h4 id="1-在-router-artcateRouter-js-中写入新增文章分类的路由"><a href="#1-在-router-artcateRouter-js-中写入新增文章分类的路由" class="headerlink" title="1- 在 router/artcateRouter.js 中写入新增文章分类的路由"></a>1- 在 <code>router/artcateRouter.js</code> 中写入新增文章分类的路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的路由</span></span><br><span class="line">router.post(<span class="string">&quot;/article/addcates&quot;</span>, artcate_handler.addCate);</span><br></pre></td></tr></table></figure>

<h4 id="2-在-route-Handler-artcateHandler-js-中写入新增文章分类的路由处理函数"><a href="#2-在-route-Handler-artcateHandler-js-中写入新增文章分类的路由处理函数" class="headerlink" title="2- 在 route_Handler/artcateHandler.js 中写入新增文章分类的路由处理函数"></a>2- 在 <code>route_Handler/artcateHandler.js</code> 中写入新增文章分类的路由处理函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增文章分类的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.addCate = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-验证表单数据"><a href="#3-验证表单数据" class="headerlink" title="3- 验证表单数据"></a>3- 验证表单数据</h4><ol>
<li><p>==创建 <code>/schema/artcateSchema.js</code> 文章分类数据验证模块并暴露出去==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99.png"></p>
</li>
<li><p>在 <code>router/artcateRouter.js</code> ==导入验证数据的中间件==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E9%AA%8C%E8%AF%81%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
</li>
<li><p>在<code>router/artcateRouter.js</code> 中修改路由模块,==添加局部中间件==</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E5%B1%80%E9%83%A8%E4%B8%AD%E9%97%B4%E4%BB%B6png.png"></p>
<h4 id="3-实现新增分类的功能"><a href="#3-实现新增分类的功能" class="headerlink" title="3- 实现新增分类的功能"></a>3- 实现新增分类的功能</h4><p>完善 <code>route_Handler/artcateHandler.js</code> 中的新增文章分类的处理函数</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-4-4-根据文章-Id-删除文章分类"><a href="#22-4-4-根据文章-Id-删除文章分类" class="headerlink" title="22.4.4 根据文章 Id 删除文章分类"></a>22.4.4 根据文章 Id 删除文章分类</h3><h4 id="1-在-router-artcateRouter-js-中写入删除文章分类的路由"><a href="#1-在-router-artcateRouter-js-中写入删除文章分类的路由" class="headerlink" title="1- 在 router/artcateRouter.js 中写入删除文章分类的路由"></a>1- 在 <code>router/artcateRouter.js</code> 中写入删除文章分类的路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&quot;/article/deletecate/:id&quot;</span>, artcateHandler.delCateById);</span><br></pre></td></tr></table></figure>

<h4 id="2-在-route-Handler-artcateHandler-js-中写入新增文章分类的路由处理函数-1"><a href="#2-在-route-Handler-artcateHandler-js-中写入新增文章分类的路由处理函数-1" class="headerlink" title="2- 在 route_Handler/artcateHandler.js 中写入新增文章分类的路由处理函数"></a>2- 在 <code>route_Handler/artcateHandler.js</code> 中写入新增文章分类的路由处理函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.delCateById = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-验证表单数据-1"><a href="#3-验证表单数据-1" class="headerlink" title="3- 验证表单数据"></a>3- 验证表单数据</h4><ol>
<li><p>在 <code>schema/artcateSchema.js</code> ==定义分类 id 的校验规则==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%88%A0%E9%99%A4%E7%9A%84%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99.png"></p>
</li>
<li><p>将校验后的==规则对象==暴露出去</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%88%A0%E9%99%A4%E7%9A%84%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1.png"></p>
</li>
<li><p>在 <code>router/artcateRouter.js</code> 中==导入校验规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E5%88%A0%E9%99%A4%E7%9A%84%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1.png"></p>
</li>
<li><p>修改 <code>router/artcateRouter.js</code> 中删除文章分类的路由，==添加个局部中间件==</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E5%88%A0%E9%99%A4%E7%9A%84%E5%B1%80%E9%83%A8%E4%B8%AD%E9%97%B4%E4%BB%B6.png"></p>
<h4 id="4-实现删除分类的功能"><a href="#4-实现删除分类的功能" class="headerlink" title="4- 实现删除分类的功能"></a>4- 实现删除分类的功能</h4><p>完善 <code>route_Handler/artcateHandler.js</code> 中的删除文章分类的处理函数</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%88%A0%E9%99%A4%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-4-5-根据-Id-获取文章分类数据"><a href="#22-4-5-根据-Id-获取文章分类数据" class="headerlink" title="22.4.5 根据 Id 获取文章分类数据"></a>22.4.5 根据 Id 获取文章分类数据</h3><h4 id="1-在-router-artcateRouter-js-中写入获取文章分类的路由"><a href="#1-在-router-artcateRouter-js-中写入获取文章分类的路由" class="headerlink" title="1- 在 router/artcateRouter.js 中写入获取文章分类的路由"></a>1- 在 <code>router/artcateRouter.js</code> 中写入获取文章分类的路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&quot;/article/cates/:id&quot;</span>, artcateHandler.getCateById);</span><br></pre></td></tr></table></figure>

<h4 id="2-在-route-Handler-artcateHandler-js-中写入获取文章分类的路由处理函数"><a href="#2-在-route-Handler-artcateHandler-js-中写入获取文章分类的路由处理函数" class="headerlink" title="2- 在 route_Handler/artcateHandler.js 中写入获取文章分类的路由处理函数"></a>2- 在 <code>route_Handler/artcateHandler.js</code> 中写入获取文章分类的路由处理函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.getCateById = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-验证表单数据-2"><a href="#3-验证表单数据-2" class="headerlink" title="3- 验证表单数据"></a>3- 验证表单数据</h4><ol>
<li><p>将校验后的==规则对象==暴露出去</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%A0%A1%E9%AA%8C%E5%AF%B9%E8%B1%A11.png"></p>
</li>
<li><p>在 <code>router/artcateRouter.js</code> 中==导入校验规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E6%A0%A1%E9%AA%8C%E5%AF%B9%E8%B1%A11.png"></p>
</li>
<li><p>修改 <code>router/artcateRouter.js</code> 中获取文章分类的路由，==添加个局部中间件==</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E8%B7%AF%E7%94%B1.png"></p>
<h4 id="4-实现分类的功能"><a href="#4-实现分类的功能" class="headerlink" title="4- 实现分类的功能"></a>4- 实现分类的功能</h4><p>完善 <code>route_Handler/artcateHandler.js</code> 中的删除文章分类的处理函数</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h3 id="22-4-6-根据-Id-更新文章分类数据"><a href="#22-4-6-根据-Id-更新文章分类数据" class="headerlink" title="22.4.6 根据 Id 更新文章分类数据"></a>22.4.6 根据 Id 更新文章分类数据</h3><h4 id="1-在-router-artcateRouter-js-中写入更新文章分类的路由"><a href="#1-在-router-artcateRouter-js-中写入更新文章分类的路由" class="headerlink" title="1- 在 router/artcateRouter.js 中写入更新文章分类的路由"></a>1- 在 <code>router/artcateRouter.js</code> 中写入更新文章分类的路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的路由</span></span><br><span class="line">router.get(<span class="string">&quot;/article/updatecate&quot;</span>, artcateHandler.updateCate);</span><br></pre></td></tr></table></figure>

<h4 id="2-在-route-Handler-artcateHandler-js-中写入更新文章分类的路由处理函数"><a href="#2-在-route-Handler-artcateHandler-js-中写入更新文章分类的路由处理函数" class="headerlink" title="2- 在 route_Handler/artcateHandler.js 中写入更新文章分类的路由处理函数"></a>2- 在 <code>route_Handler/artcateHandler.js</code> 中写入更新文章分类的路由处理函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文章分类的处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.updateCate = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-验证表单数据-3"><a href="#3-验证表单数据-3" class="headerlink" title="3- 验证表单数据"></a>3- 验证表单数据</h4><ol>
<li><p>将校验后的==规则对象==暴露出去</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%A0%A1%E9%AA%8C%E5%AF%B9%E8%B1%A12.png"></p>
</li>
<li><p>在 <code>router/artcateRouter.js</code> 中==导入校验规则对象==</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%AF%BC%E5%85%A5%E6%A0%A1%E9%AA%8C%E5%AF%B9%E8%B1%A12.png"></p>
</li>
<li><p>修改 <code>router/artcateRouter.js</code> 中更新文章分类的路由，==添加个局部中间件==</p>
</li>
</ol>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B01.png"></p>
<h4 id="4-实现分类的功能-1"><a href="#4-实现分类的功能-1" class="headerlink" title="4- 实现分类的功能"></a>4- 实现分类的功能</h4><p>完善 <code>route_Handler/artcateHandler.js</code> 中的更新文章分类的处理函数</p>
<p><img src= "/img/loading.gif" data-lazy-src="/images/%E6%9B%B4%E6%96%B0.png"></p>
<h2 id="22-5-发布新文章"><a href="#22-5-发布新文章" class="headerlink" title="22.5 发布新文章"></a>22.5 发布新文章</h2><h3 id="22-5-1-新建ev-articles表"><a href="#22-5-1-新建ev-articles表" class="headerlink" title="22.5.1 新建ev_articles表"></a>22.5.1 新建<code>ev_articles</code>表</h3><h3 id="22-5-2-初始化路由模块"><a href="#22-5-2-初始化路由模块" class="headerlink" title="22.5.2 初始化路由模块"></a>22.5.2 初始化路由模块</h3><h4 id="1-新建-router-articleRoute-js-发布文章的路由模块"><a href="#1-新建-router-articleRoute-js-发布文章的路由模块" class="headerlink" title="1- 新建 router/articleRoute.js 发布文章的路由模块"></a>1- 新建 <code>router/articleRoute.js</code> 发布文章的路由模块</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%8F%91%E5%B8%83%E6%96%B0%E6%96%87%E7%AB%A0%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97.png"></p>
<h4 id="2-新建-router-Handler-articleHandler-js-发布文章的路由处理函数"><a href="#2-新建-router-Handler-articleHandler-js-发布文章的路由处理函数" class="headerlink" title="2- 新建 router_Handler/articleHandler.js 发布文章的路由处理函数"></a>2- 新建 <code>router_Handler/articleHandler.js</code> 发布文章的路由处理函数</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%8F%91%E5%B8%83%E6%96%B0%E6%96%87%E7%AB%A0%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0.png"></p>
<h4 id="3-在-app-js-导入路由处理对象并注册"><a href="#3-在-app-js-导入路由处理对象并注册" class="headerlink" title="3- 在 app.js 导入路由处理对象并注册"></a>3- 在 <code>app.js</code> 导入路由处理对象并注册</h4><p><img src= "/img/loading.gif" data-lazy-src="/images/%E5%8F%91%E5%B8%83%E6%96%B0%E6%96%87%E7%AB%A0.png"></p>
<h3 id="22-5-3-使用-multer-解析表单数据"><a href="#22-5-3-使用-multer-解析表单数据" class="headerlink" title="22.5.3 使用 multer 解析表单数据"></a>22.5.3 使用 multer 解析表单数据</h3><h4 id="1-安装-multer-导入解析-formdata-数据的包"><a href="#1-安装-multer-导入解析-formdata-数据的包" class="headerlink" title="1- 安装 multer 导入解析 formdata 数据的包"></a>1- 安装 <code>multer</code> 导入解析 formdata 数据的包</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入解析formdata数据的包(把携带的二进制文件保存到指定目录)</span></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>);</span><br><span class="line"><span class="comment">// 创建multer实例(指定文件保存到哪里)</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> uploads = multer(&#123;</span><br><span class="line">  dest: path.join(__dirname, <span class="string">&quot;../uploads&quot;</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2-修改发布文章的路由"><a href="#2-修改发布文章的路由" class="headerlink" title="2- 修改发布文章的路由"></a>2- 修改发布文章的路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// upload.single() 是一个局部生效的中间件，用来解析 FormData 格式的表单数据</span></span><br><span class="line"><span class="comment">// 将文件类型的数据，解析并挂载到 req.file 属性中</span></span><br><span class="line"><span class="comment">// 将文本类型的数据，解析并挂载到 req.body 属性中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布文章的路由(增加局部中间件，解析formdata数据并且把携带的图片文件在佛那个保存起来)</span></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/article/add&quot;</span>,</span><br><span class="line">  uploads.single(<span class="string">&quot;cover_img&quot;</span>),</span><br><span class="line">  articleHandler.add_article</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="22-5-4-验证表单数据"><a href="#22-5-4-验证表单数据" class="headerlink" title="22.5.4 验证表单数据"></a>22.5.4 验证表单数据</h3><h4 id="1-创建-schema-articleSchema-js-验证规则模块，并初始化如下的代码结构"><a href="#1-创建-schema-articleSchema-js-验证规则模块，并初始化如下的代码结构" class="headerlink" title="1-创建 /schema/articleSchema.js 验证规则模块，并初始化如下的代码结构"></a>1-创建 <code>/schema/articleSchema.js</code> 验证规则模块，并初始化如下的代码结构</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入定义验证规则的模块</span></span><br><span class="line"><span class="keyword">const</span> Joi = <span class="built_in">require</span>(<span class="string">&quot;@hapi/joi&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 标题、分类Id、内容、发布状态 的验证规则</span></span><br><span class="line"><span class="keyword">const</span> title = Joi.string().required();</span><br><span class="line"><span class="keyword">const</span> cate_id = Joi.number().integer().min(<span class="number">1</span>).required();</span><br><span class="line"><span class="keyword">const</span> content = Joi.string().required().allow(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> state = Joi.string().valid(<span class="string">&quot;已发布&quot;</span>, <span class="string">&quot;草稿&quot;</span>).required();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证规则对象 - 发布文章</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  add_article_schema: &#123;</span><br><span class="line">    body: &#123;</span><br><span class="line">      title,</span><br><span class="line">      cate_id,</span><br><span class="line">      content,</span><br><span class="line">      state,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-在-router-articleRouter-js-模块中，导入需要的验证规则对象，并在路由中使用"><a href="#2-在-router-articleRouter-js-模块中，导入需要的验证规则对象，并在路由中使用" class="headerlink" title="2- 在 /router/articleRouter.js 模块中，导入需要的验证规则对象，并在路由中使用"></a>2- 在 <code>/router/articleRouter.js</code> 模块中，导入需要的验证规则对象，并在路由中使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&quot;@escook/express-joi&quot;</span>);</span><br><span class="line"><span class="comment">// 导入文章的验证模块</span></span><br><span class="line"><span class="keyword">const</span> &#123; add_article_schema &#125; = <span class="built_in">require</span>(<span class="string">&quot;../schema/articleSchema&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布新文章的路由</span></span><br><span class="line"><span class="comment">// upload.single() 是一个局部生效的中间件，用来解析 FormData 格式的表单数据</span></span><br><span class="line"><span class="comment">// 将文件类型的数据，解析并挂载到 req.file 属性中</span></span><br><span class="line"><span class="comment">// 将文本类型的数据，解析并挂载到 req.body 属性中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布文章的路由(增加局部中间件，解析formdata数据并且把携带的图片文件在佛那个保存起来)</span></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/article/add&quot;</span>,</span><br><span class="line">  uploads.single(<span class="string">&quot;cover_img&quot;</span>),</span><br><span class="line">  expressJoi(add_article_schema),</span><br><span class="line">  articleHandler.add_article</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="3-在-router-handler-articleHandler-js-模块中的路由处理函数中，通过-if-判断客户端是否提交了-封面图片"><a href="#3-在-router-handler-articleHandler-js-模块中的路由处理函数中，通过-if-判断客户端是否提交了-封面图片" class="headerlink" title="3- 在 /router_handler/articleHandler.js 模块中的路由处理函数中，通过 if 判断客户端是否提交了 封面图片"></a>3- 在 <code>/router_handler/articleHandler.js</code> 模块中的路由处理函数中，通过 <code>if</code> 判断客户端是否提交了 <code>封面图片</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动判断是否上传了文章封面</span></span><br><span class="line"><span class="keyword">if</span> (!req.file || req.file.fieldname !== <span class="string">&quot;cover_img&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.cc(<span class="string">&quot;文章封面是必选参数！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-5-5-实现发布文章的功能"><a href="#22-5-5-实现发布文章的功能" class="headerlink" title="22.5.5 实现发布文章的功能"></a>22.5.5 实现发布文章的功能</h3><ol>
<li><p>具体代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&quot;../db/index&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; decodeBase64 &#125; = <span class="built_in">require</span>(<span class="string">&quot;bcryptjs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">// 发布文章的路由处理函数</span></span><br><span class="line"><span class="built_in">module</span>.exports.add_article = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.file);</span><br><span class="line">  <span class="comment">// 手动判断是否上传了文章封面</span></span><br><span class="line">  <span class="keyword">if</span> (!req.file || req.file.fieldname !== <span class="string">&quot;cover_img&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.cc(<span class="string">&quot;文章封面是必选参数！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加数据</span></span><br><span class="line">  <span class="comment">// 准备文章数据对象</span></span><br><span class="line">  <span class="keyword">const</span> articleInfo = &#123;</span><br><span class="line">    ...req.body, <span class="comment">//&#123; title: &#x27;三生三世十里桃花&#x27;, cate_id: 3, content: &#x27;棉花&#x27;, state: &#x27;已发布&#x27; &#125;</span></span><br><span class="line">    cover_img: path.join(<span class="string">&quot;/uploads&quot;</span>, req.file.filename),</span><br><span class="line">    pub_date: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    author_id: req.user.id,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> sql = <span class="string">&quot;insert into ev_articles set ?&quot;</span>;</span><br><span class="line">  db.query(sql, articleInfo, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err);</span><br><span class="line">    <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.cc(<span class="string">&quot;发布文章失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.cc(<span class="string">&quot;发布文章成功&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(articleInfo);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>在 <code>app.js</code> 中，使用 <code>express.static()</code> 中间件，将 <code>uploads</code> 目录中的图片托管为静态资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 托管静态资源的中间件</span></span><br><span class="line">app.use(<span class="string">&quot;/uploads&quot;</span>, express.static(<span class="string">&quot;uploads&quot;</span>));</span><br></pre></td></tr></table></figure></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ananiu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ananiu.xyz/posts/nodejs.html/">https://ananiu.xyz/posts/nodejs.html/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ananiu.xyz" target="_blank">Ananiu's BLOG</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Node/">Node</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/12/10/PxUtYv75oglSq8D.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/jsgaoji.html/"><img class="prev-cover" data-lazy-src="https://i.loli.net/2020/12/10/e2E7d5mRJstTNu9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">js高级</div></div></a></div><div class="next-post pull-right"><a href="/posts/js.html/"><img class="next-cover" data-lazy-src="https://i.loli.net/2020/12/10/IQtwislgCEvzVMa.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaScript基础</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/ananius/blog/userpic.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Ananiu</div><div class="author-info__description">一个收藏回忆与分享技术的地方</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a></div></div><a class="button--animated" id="card-info-btn" href="/"><i class="fa fa-bookmark"></i><span>点我~~</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=5712974" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://github.com/ananius" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-fs-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">1. fs 文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-fs-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 fs 文件系统模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E8%AF%BB%E5%8F%96%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9-%E2%98%85"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 读取指定文件中的内容 ★</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%90%91%E6%8C%87%E5%AE%9A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%AD%E5%86%99%E5%85%A5%E5%86%85%E5%AE%B9-%E2%98%85"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 向指定的文件中写入内容 ★</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-fs-%E6%95%B4%E7%90%86%E8%80%83%E8%AF%95%E6%88%90%E7%BB%A9%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 fs 整理考试成绩案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-path-%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">2. path 路径模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%BB%80%E4%B9%88%E6%98%AF-path-%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9D%97"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 什么是 path 路径模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-path-%E8%B7%AF%E5%BE%84%E6%8B%BC%E6%8E%A5"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 path 路径拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-path-basename-%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 path.basename() 获取路径中的文件名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-path-extname-%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 path.extname() 获取路径中的文件扩展名</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%97%B6%E9%92%9F%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">3. 时钟案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-http-%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">4. http 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%88%9B%E5%BB%BA-web-%E6%9C%8D%E5%8A%A1%E5%99%A8-%E2%98%85"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 创建 web 服务器 ★</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 创建基本的服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E8%A7%A3%E5%86%B3%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 解决中文乱码问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84-url-%E5%93%8D%E5%BA%94%E4%B8%8D%E5%90%8C%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 根据不同的 url 响应不同的内容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%97%B6%E9%92%9F-web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">5. 时钟 web 服务器案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Node-%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">6. Node 中的模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 模块化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 模块的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 模块的作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E6%A8%A1%E5%9D%97%E6%88%90%E5%91%98"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 模块成员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-module-exports-%E5%AF%B9%E8%B1%A1-%E2%98%85"><span class="toc-number">6.5.</span> <span class="toc-text">6.5 module.exports 对象 ★</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-module-exports-%E5%AF%B9%E8%B1%A1%E4%B8%80%E9%94%AE%E5%85%B1%E4%BA%AB%E5%A4%9A%E4%B8%AA%E6%88%90%E5%91%98"><span class="toc-number">6.6.</span> <span class="toc-text">6.6 module.exports 对象一键共享多个成员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-7-exports-%E5%AF%B9%E8%B1%A1"><span class="toc-number">6.7.</span> <span class="toc-text">6.7 exports 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-8-exports-%E5%92%8C-module-exports-%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%AF%E5%8C%BA"><span class="toc-number">6.8.</span> <span class="toc-text">6.8 exports 和 module.exports 的使用误区</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-npm-%E5%88%9D%E4%BD%93%E9%AA%8C-%EF%BC%88%E5%8C%85%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">7. npm 初体验 （包）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85%E5%AF%B9%E6%97%B6%E9%97%B4%E8%BF%9B%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 使用第三方包对时间进行格式化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-npm-install-%E5%91%BD%E4%BB%A4%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 npm install 命令安装包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84%E5%8C%85"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 设置指定版本的包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E5%8D%B8%E8%BD%BD%E5%8C%85"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 卸载包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E8%A7%A3%E5%86%B3%E5%8C%85%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 解决包下载速度慢的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%8C%85%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text">8. 包管理配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-package-json"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 package.json</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA-package-json"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 快速创建 package.json</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E4%B8%80%E6%AC%A1%E6%80%A7%E5%AE%89%E8%A3%85%E6%89%80%E6%9C%89%E5%8C%85"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 一次性安装所有包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%8C%85%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">9.</span> <span class="toc-text">9. 包的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E9%A1%B9%E7%9B%AE%E5%8C%85"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 项目包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%85%A8%E5%B1%80%E5%8C%85"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 全局包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-i5ting-toc-%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 i5ting_toc 的安装和使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-express"><span class="toc-number">10.</span> <span class="toc-text">10. express</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-Express-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 Express 的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">10.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-express"><span class="toc-number">10.1.2.</span> <span class="toc-text">导入 express</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.1.3.</span> <span class="toc-text">创建 web 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E8%AF%B7%E6%B1%82"><span class="toc-number">10.1.4.</span> <span class="toc-text">监听请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.1.5.</span> <span class="toc-text">启动服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E7%9B%91%E5%90%AC-GET-%E5%92%8C-POST-%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E5%BD%B1%E5%93%8D%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 监听 GET 和 POST 请求，并影响客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-http-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A"><span class="toc-number">10.2.1.</span> <span class="toc-text">10.2.1 http 创建服务器：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-express-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A"><span class="toc-number">10.2.2.</span> <span class="toc-text">10.2.2 express 创建服务器：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E8%8E%B7%E5%8F%96-URL-%E4%B8%AD%E6%90%BA%E5%B8%A6%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 获取 URL 中携带的查询参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-%E8%8E%B7%E5%8F%96-URL-%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0"><span class="toc-number">10.4.</span> <span class="toc-text">10.4 获取 URL 中的动态参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5-%E8%8E%B7%E5%8F%96-URL-%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">10.5.</span> <span class="toc-text">10.5 获取 URL 中的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-6-%E6%89%98%E7%AE%A1%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">10.6.</span> <span class="toc-text">10.6 托管静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-1-express-static"><span class="toc-number">10.6.1.</span> <span class="toc-text">10.6.1 express.static()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-2-%E6%89%98%E7%AE%A1%E5%A4%9A%E4%B8%AA%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95"><span class="toc-number">10.6.2.</span> <span class="toc-text">10.6.2 托管多个静态资源目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-3-%E6%8C%82%E8%BD%BD%E8%B7%AF%E5%BE%84%E5%89%8D%E7%BC%80"><span class="toc-number">10.6.3.</span> <span class="toc-text">10.6.3 挂载路径前缀</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E8%B7%AF%E7%94%B1"><span class="toc-number">11.</span> <span class="toc-text">11. 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-Express-%E8%B7%AF%E7%94%B1"><span class="toc-number">11.1.</span> <span class="toc-text">11.1 Express 路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E8%B7%AF%E7%94%B1%E6%8C%82%E8%BD%BD"><span class="toc-number">11.2.</span> <span class="toc-text">11.2 路由挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D"><span class="toc-number">11.3.</span> <span class="toc-text">11.3 路由匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-Express-%E8%B7%AF%E7%94%B1%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">11.4.</span> <span class="toc-text">11.4 Express 路由最简单的用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%B7%AF%E7%94%B1"><span class="toc-number">11.5.</span> <span class="toc-text">11.5 模块化路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-%E6%8A%8A%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%94%BE%E5%88%B0%E5%8D%95%E7%8B%AC%E7%9A%84%E6%A8%A1%E5%9D%97-%E2%98%85"><span class="toc-number">11.6.</span> <span class="toc-text">11.6 把路由处理函数放到单独的模块 ★</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">12. 中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-Express-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">12.1.</span> <span class="toc-text">12.1 Express 中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-Express-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">12.2.</span> <span class="toc-text">12.2 Express 中间件的格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E5%85%A8%E5%B1%80%E7%94%9F%E6%95%88%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6-%E2%97%8B"><span class="toc-number">12.3.</span> <span class="toc-text">12.3 全局生效的中间件 ○</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4-%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">12.4.</span> <span class="toc-text">12.4 定义多个全局中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-5-%E5%B1%80%E9%83%A8%E7%94%9F%E6%95%88%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6-%E2%97%8B"><span class="toc-number">12.5.</span> <span class="toc-text">12.5 局部生效的中间件 ○</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-6-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">12.6.</span> <span class="toc-text">12.6 中间件的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-7-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84-5-%E4%B8%AA%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">12.7.</span> <span class="toc-text">12.7 中间件的 5 个使用注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">13.</span> <span class="toc-text">13. 中间件的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">13.1.</span> <span class="toc-text">13.1 中间件的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">13.2.</span> <span class="toc-text">13.2 应用级别的中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E8%B7%AF%E7%94%B1%E7%BA%A7%E5%88%AB%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">13.3.</span> <span class="toc-text">13.3 路由级别的中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-4-%E9%94%99%E8%AF%AF%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6-%E2%97%8B"><span class="toc-number">13.4.</span> <span class="toc-text">13.4 错误级别中间件 ○</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-5-Express-%E5%86%85%E7%BD%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6-%E2%97%8B"><span class="toc-number">13.5.</span> <span class="toc-text">13.5 Express 内置的中间件 ○</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-1-express-json-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.5.1.</span> <span class="toc-text">13.5.1 express.json 中间件的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-2-express-urlencoded-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.5.2.</span> <span class="toc-text">13.5.2 express.urlencoded 中间件的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-6-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">13.6.</span> <span class="toc-text">13.6 第三方的中间件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">14.</span> <span class="toc-text">14. 自定义中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-%E9%9C%80%E6%B1%82%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">14.1.</span> <span class="toc-text">14.1 需求以及实现步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">14.2.</span> <span class="toc-text">14.2 定义中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-%E7%9B%91%E5%90%AC-req-%E7%9A%84-data-%E4%BA%8B%E4%BB%B6"><span class="toc-number">14.3.</span> <span class="toc-text">14.3 监听 req 的 data 事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-4-%E7%9B%91%E5%90%AC-req-%E7%9A%84-end-%E4%BA%8B%E4%BB%B6"><span class="toc-number">14.4.</span> <span class="toc-text">14.4 监听 req 的 end 事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-5-%E7%94%A8-querystring-%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="toc-number">14.5.</span> <span class="toc-text">14.5 用 querystring 模块解析请求体数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-6-%E5%B0%86%E8%A7%A3%E6%9E%90%E5%87%BA%E6%9D%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%E6%8C%82%E8%BD%BD%E4%B8%BA-req-body"><span class="toc-number">14.6.</span> <span class="toc-text">14.6 将解析出来的数据对象挂载为 req.body</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-7-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">14.7.</span> <span class="toc-text">14.7 自定义中间件完整代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-%E5%9F%BA%E4%BA%8E-Express-%E5%86%99%E6%8E%A5%E5%8F%A3-%E2%97%8B"><span class="toc-number">15.</span> <span class="toc-text">15. 基于 Express 写接口 ○</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-cors"><span class="toc-number">16.</span> <span class="toc-text">16. cors</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#16-1-%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">16.1.</span> <span class="toc-text">16.1 接口的跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-2-%E4%BD%BF%E7%94%A8-cors-%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">16.2.</span> <span class="toc-text">16.2 使用 cors 中间件解决跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-3-cors-%E8%AF%B7%E6%B1%82%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">16.3.</span> <span class="toc-text">16.3 cors 请求的分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-jsonp"><span class="toc-number">17.</span> <span class="toc-text">17. jsonp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-JSONP-%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">17.1.</span> <span class="toc-text">实现 JSONP 接口的步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-jQuery-%E5%8F%91%E8%B5%B7-JSONP-%E8%AF%B7%E6%B1%82"><span class="toc-number">17.2.</span> <span class="toc-text">使用 jQuery 发起 JSONP 请求</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-SQL-%E8%AF%AD%E5%8F%A5-%E2%98%85"><span class="toc-number">18.</span> <span class="toc-text">18. SQL 语句 ★</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#18-1-%E4%BB%80%E4%B9%88%E6%98%AF-SQL"><span class="toc-number">18.1.</span> <span class="toc-text">18.1 什么是 SQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-2-SQL-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">18.2.</span> <span class="toc-text">18.2 SQL 能做什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-3-SQL-%E7%9A%84-select-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">18.3.</span> <span class="toc-text">18.3 SQL 的 select 查询语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-4-SQL-%E7%9A%84-insert-into-%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="toc-number">18.4.</span> <span class="toc-text">18.4 SQL 的 insert into 插入语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-5-SQL-%E7%9A%84-update-%E4%BF%AE%E6%94%B9%E8%AF%AD%E5%8F%A5"><span class="toc-number">18.5.</span> <span class="toc-text">18.5 SQL 的 update 修改语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-6-SQL-%E7%9A%84-delete-%E5%88%A0%E9%99%A4%E8%AF%AD%E5%8F%A5"><span class="toc-number">18.6.</span> <span class="toc-text">18.6 SQL 的 delete 删除语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-7-SQL-%E7%9A%84-where-%E5%AD%90%E5%8F%A5"><span class="toc-number">18.7.</span> <span class="toc-text">18.7 SQL 的 where 子句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-8-SQL-%E7%9A%84-and-%E5%92%8C-or-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">18.8.</span> <span class="toc-text">18.8 SQL 的 and 和 or 运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-9-SQL-%E7%9A%84-order-by-%E5%AD%90%E5%8F%A5"><span class="toc-number">18.9.</span> <span class="toc-text">18.9 SQL 的 order by 子句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-10-order-by-%E5%AD%90%E5%8F%A5-%E2%80%93-%E5%A4%9A%E9%87%8D%E6%8E%92%E5%BA%8F"><span class="toc-number">18.10.</span> <span class="toc-text">18.10 order by 子句 – 多重排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-11-SQL-count-%E5%87%BD%E6%95%B0"><span class="toc-number">18.11.</span> <span class="toc-text">18.11 SQL count(*) 函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-12-%E4%BD%BF%E7%94%A8-as-%E4%B8%BA%E5%88%97%E8%AE%BE%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc-number">18.12.</span> <span class="toc-text">18.12 使用 as 为列设置别名</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-js-%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C-MySQL-%E6%A8%A1%E5%9D%97"><span class="toc-number">19.</span> <span class="toc-text">19. js 代码操作 MySQL 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#19-1-%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">19.1.</span> <span class="toc-text">19.1 操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-2-%E5%86%99%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">19.2.</span> <span class="toc-text">19.2 写基本的接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9B%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">19.2.1.</span> <span class="toc-text">一、创一个服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8D%95%E7%8B%AC%E8%AE%BE%E7%BD%AE%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">19.2.2.</span> <span class="toc-text">二、单独设置路由模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8D%95%E7%8B%AC%E6%A8%A1%E5%9D%97%E6%9D%A5%E5%86%99%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">19.2.3.</span> <span class="toc-text">三、单独模块来写路由处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%8D%95%E7%8B%AC%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97%E6%9D%A5%E5%86%99%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">19.2.4.</span> <span class="toc-text">四、单独一个模块来写数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-session"><span class="toc-number">20.</span> <span class="toc-text">20. session</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#20-1-%E4%BB%80%E4%B9%88%E6%98%AF-cookie"><span class="toc-number">20.1.</span> <span class="toc-text">20.1 什么是 cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-2-%E5%AE%89%E8%A3%85-express-session-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">20.2.</span> <span class="toc-text">20.2 安装 express-session 中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-3-%E5%90%91-session-%E4%B8%AD%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">20.3.</span> <span class="toc-text">20.3 向 session 中存数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-4-%E4%BB%8E-session-%E4%B8%AD%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">20.4.</span> <span class="toc-text">20.4 从 session 中取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-5-%E6%B8%85%E7%A9%BA-session"><span class="toc-number">20.5.</span> <span class="toc-text">20.5 清空 session</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-jwt"><span class="toc-number">21.</span> <span class="toc-text">21. jwt</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-1-JWT-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">21.1.</span> <span class="toc-text">21.1 JWT 的工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-2-JWT-%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">21.2.</span> <span class="toc-text">21.2 JWT 的组成部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-3-JWT-%E5%AE%89%E8%A3%85"><span class="toc-number">21.3.</span> <span class="toc-text">21.3 JWT 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-4-%E5%AF%BC%E5%85%A5-JWT"><span class="toc-number">21.4.</span> <span class="toc-text">21.4 导入 JWT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-5-%E5%AE%9A%E4%B9%89-secret-%E5%AF%86%E9%92%A5"><span class="toc-number">21.5.</span> <span class="toc-text">21.5 定义 secret 密钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-6-%E5%9C%A8%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%90%8E%E7%94%9F%E6%88%90-JWT-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">21.6.</span> <span class="toc-text">21.6 在登录成功后生成 JWT 字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-7-%E5%B0%86-JWT-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%98%E5%8E%9F%E4%B8%BA-JSON-%E5%AF%B9%E8%B1%A1"><span class="toc-number">21.7.</span> <span class="toc-text">21.7 将 JWT 字符串还原为 JSON 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-8-%E4%BD%BF%E7%94%A8-req-user-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">21.8.</span> <span class="toc-text">21.8 使用 req.user 获取用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-9-%E6%8D%95%E8%8E%B7%E8%A7%A3%E6%9E%90-JWT-%E5%A4%B1%E8%B4%A5%E5%90%8E%E4%BA%A7%E7%94%9F%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">21.9.</span> <span class="toc-text">21.9 捕获解析 JWT 失败后产生的错误</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-%E5%A4%A7%E4%BA%8B%E4%BB%B6%E9%A1%B9%E7%9B%AE-api-server"><span class="toc-number">22.</span> <span class="toc-text">22. 大事件项目 api_server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#22-1-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">22.1.</span> <span class="toc-text">22.1 初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-1-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">22.1.1.</span> <span class="toc-text">22.1.1 创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-2-%E9%85%8D%E7%BD%AE-cors-%E8%B7%A8%E5%9F%9F"><span class="toc-number">22.1.2.</span> <span class="toc-text">22.1.2 配置 cors 跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-3-%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">22.1.3.</span> <span class="toc-text">22.1.3 配置解析表单数据的中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-4-%E5%88%9D%E5%A7%8B%E5%8C%96%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">22.1.4.</span> <span class="toc-text">22.1.4 初始化路由模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-5-%E6%8A%BD%E7%A6%BB%E7%94%A8%E6%88%B7%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">22.1.5.</span> <span class="toc-text">22.1.5 抽离用户路由模块中的处理函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-2-%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C"><span class="toc-number">22.2.</span> <span class="toc-text">22.2 登录注册</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-2-1-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">22.2.1.</span> <span class="toc-text">22.2.1 新建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-2-2-%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE-mysql-%E6%A8%A1%E5%9D%97"><span class="toc-number">22.2.2.</span> <span class="toc-text">22.2.2 安装并配置 mysql 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-%E6%B3%A8%E5%86%8C"><span class="toc-number">22.2.3.</span> <span class="toc-text">22.3 注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#22-3-1-%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">22.2.3.1.</span> <span class="toc-text">22.3.1 实现的步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-3-2-%E6%A3%80%E6%B5%8B%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95"><span class="toc-number">22.2.3.2.</span> <span class="toc-text">22.3.2 检测表单数据是否合法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-3-3-%E6%A3%80%E6%B5%8B%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%AF%E5%90%A6%E8%A2%AB%E5%8D%A0%E7%94%A8"><span class="toc-number">22.2.3.3.</span> <span class="toc-text">22.3.3 检测用户名是否被占用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-3-4-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86"><span class="toc-number">22.2.3.4.</span> <span class="toc-text">22.3.4 对密码进行加密处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-3-5-%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7"><span class="toc-number">22.2.3.5.</span> <span class="toc-text">22.3.5 添加新用户</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-%E4%BC%98%E5%8C%96-res-send"><span class="toc-number">22.2.4.</span> <span class="toc-text">22.4 优化 res.send()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-%E4%BC%98%E5%8C%96%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">22.2.5.</span> <span class="toc-text">22.5 优化表单数据验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-6-%E7%99%BB%E5%BD%95"><span class="toc-number">22.2.6.</span> <span class="toc-text">22.6 登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-1-%E6%A3%80%E9%AA%8C%E7%99%BB%E5%BD%95%E8%A1%A8%E5%8D%95%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95"><span class="toc-number">22.2.6.1.</span> <span class="toc-text">22.6.1 检验登录表单是否合法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-2-%E5%AE%89%E8%A3%85%E7%94%9F%E6%88%90-Token-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%8C%85"><span class="toc-number">22.2.6.2.</span> <span class="toc-text">22.6.2 安装生成 Token 字符串的包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-3-%E5%AF%BC%E5%85%A5-jsonwebtoken-%E5%8C%85"><span class="toc-number">22.2.6.3.</span> <span class="toc-text">22.6.3 导入 jsonwebtoken 包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-4-%E5%9C%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BA-config-js-%E6%96%87%E4%BB%B6"><span class="toc-number">22.2.6.4.</span> <span class="toc-text">22.6.4 在根目录下创建 config.js 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-5-%E8%BF%99%E4%B8%80%E6%AD%A5%E5%85%B3%E9%94%AE%E5%91%A6"><span class="toc-number">22.2.6.5.</span> <span class="toc-text">22.6.5 这一步关键呦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-6-6-%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90-token-%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">22.2.6.6.</span> <span class="toc-text">22.6.6 配置解析 token 的中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E8%A7%A3%E6%9E%90-token-%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">22.2.6.6.1.</span> <span class="toc-text">1. 安装解析 token 的中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9C%A8-app-js-%E4%B8%AD%E6%B3%A8%E5%86%8C%E8%B7%AF%E7%94%B1%E4%B9%8B%E5%89%8D%EF%BC%8C%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90-Token-%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">22.2.6.6.2.</span> <span class="toc-text">2. 在 app.js 中注册路由之前，配置解析 Token 的中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%9C%A8-app-js-%E4%B8%AD%E7%9A%84-%E9%94%99%E8%AF%AF%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6-%E9%87%8C%E9%9D%A2%EF%BC%8C%E6%8D%95%E8%8E%B7%E5%B9%B6%E5%A4%84%E7%90%86-Token-%E8%AE%A4%E8%AF%81%E5%A4%B1%E8%B4%A5%E5%90%8E%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">22.2.6.6.3.</span> <span class="toc-text">3. 在 app.js 中的 错误级别中间件 里面，捕获并处理 Token 认证失败后的错误</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-3-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-number">22.3.</span> <span class="toc-text">22.3 个人中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-1-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">22.3.1.</span> <span class="toc-text">22.3.1 获取用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-2-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">22.3.2.</span> <span class="toc-text">22.3.2 更新用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E6%9B%B4%E6%96%B0%E8%B7%AF%E7%94%B1%E5%92%8C%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%A8%A1%E5%9D%97"><span class="toc-number">22.3.2.1.</span> <span class="toc-text">1-定义更新路由和路由处理函数模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">22.3.2.2.</span> <span class="toc-text">2- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">22.3.2.3.</span> <span class="toc-text">3- 实现的基本功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-3-%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">22.3.3.</span> <span class="toc-text">22.3.3 重置密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E8%B7%AF%E7%94%B1%E5%92%8C%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%A8%A1%E5%9D%97"><span class="toc-number">22.3.3.1.</span> <span class="toc-text">1- 定义重置密码的路由和路由处理函数模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE-1"><span class="toc-number">22.3.3.2.</span> <span class="toc-text">2- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">22.3.3.3.</span> <span class="toc-text">3- 实现重置密码的功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-4-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E5%A4%B4%E5%83%8F"><span class="toc-number">22.3.4.</span> <span class="toc-text">22.3.4 更新用户头像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E6%9B%B4%E6%96%B0%E5%A4%B4%E5%83%8F%E8%B7%AF%E7%94%B1%E5%92%8C%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%A8%A1%E5%9D%97"><span class="toc-number">22.3.4.1.</span> <span class="toc-text">1-定义更新头像路由和路由处理函数模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE-2"><span class="toc-number">22.3.4.2.</span> <span class="toc-text">2- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD-1"><span class="toc-number">22.3.4.3.</span> <span class="toc-text">3- 实现的基本功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-4-%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">22.4.</span> <span class="toc-text">22.4 文章分类管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-1-%E6%96%B0%E5%BB%BA-ev-article-cate-%E8%A1%A8"><span class="toc-number">22.4.1.</span> <span class="toc-text">22.4.1 新建 ev_article_cate 表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-2-%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"><span class="toc-number">22.4.2.</span> <span class="toc-text">22.4.2 获取文章分类列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B0%E5%BB%BA-router-articleRouter-js%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">22.4.2.1.</span> <span class="toc-text">1- 初始化新建 router&#x2F;articleRouter.js路由模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B0%E5%BB%BArouter-Handler-artcateHandler-js-%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E6%A8%A1%E5%9D%97"><span class="toc-number">22.4.2.2.</span> <span class="toc-text">2- 初始化新建router_Handler&#x2F;artcateHandler.js 路由处理函数模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9C%A8-app-js-%E4%B8%AD%E5%AF%BC%E5%85%A5%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">22.4.2.3.</span> <span class="toc-text">3- 在 app.js 中导入路由模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">22.4.2.4.</span> <span class="toc-text">4- 获取文章列表操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-3-%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB"><span class="toc-number">22.4.3.</span> <span class="toc-text">22.4.3 新增文章分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8-router-artcateRouter-js-%E4%B8%AD%E5%86%99%E5%85%A5%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">22.4.3.1.</span> <span class="toc-text">1- 在 router&#x2F;artcateRouter.js 中写入新增文章分类的路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8-route-Handler-artcateHandler-js-%E4%B8%AD%E5%86%99%E5%85%A5%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">22.4.3.2.</span> <span class="toc-text">2- 在 route_Handler&#x2F;artcateHandler.js 中写入新增文章分类的路由处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">22.4.3.3.</span> <span class="toc-text">3- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">22.4.3.4.</span> <span class="toc-text">3- 实现新增分类的功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-4-%E6%A0%B9%E6%8D%AE%E6%96%87%E7%AB%A0-Id-%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB"><span class="toc-number">22.4.4.</span> <span class="toc-text">22.4.4 根据文章 Id 删除文章分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8-router-artcateRouter-js-%E4%B8%AD%E5%86%99%E5%85%A5%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">22.4.4.1.</span> <span class="toc-text">1- 在 router&#x2F;artcateRouter.js 中写入删除文章分类的路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8-route-Handler-artcateHandler-js-%E4%B8%AD%E5%86%99%E5%85%A5%E6%96%B0%E5%A2%9E%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0-1"><span class="toc-number">22.4.4.2.</span> <span class="toc-text">2- 在 route_Handler&#x2F;artcateHandler.js 中写入新增文章分类的路由处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE-1"><span class="toc-number">22.4.4.3.</span> <span class="toc-text">3- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9E%E7%8E%B0%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">22.4.4.4.</span> <span class="toc-text">4- 实现删除分类的功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-5-%E6%A0%B9%E6%8D%AE-Id-%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">22.4.5.</span> <span class="toc-text">22.4.5 根据 Id 获取文章分类数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8-router-artcateRouter-js-%E4%B8%AD%E5%86%99%E5%85%A5%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">22.4.5.1.</span> <span class="toc-text">1- 在 router&#x2F;artcateRouter.js 中写入获取文章分类的路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8-route-Handler-artcateHandler-js-%E4%B8%AD%E5%86%99%E5%85%A5%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">22.4.5.2.</span> <span class="toc-text">2- 在 route_Handler&#x2F;artcateHandler.js 中写入获取文章分类的路由处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE-2"><span class="toc-number">22.4.5.3.</span> <span class="toc-text">3- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">22.4.5.4.</span> <span class="toc-text">4- 实现分类的功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-6-%E6%A0%B9%E6%8D%AE-Id-%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">22.4.6.</span> <span class="toc-text">22.4.6 根据 Id 更新文章分类数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8-router-artcateRouter-js-%E4%B8%AD%E5%86%99%E5%85%A5%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">22.4.6.1.</span> <span class="toc-text">1- 在 router&#x2F;artcateRouter.js 中写入更新文章分类的路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8-route-Handler-artcateHandler-js-%E4%B8%AD%E5%86%99%E5%85%A5%E6%9B%B4%E6%96%B0%E6%96%87%E7%AB%A0%E5%88%86%E7%B1%BB%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">22.4.6.2.</span> <span class="toc-text">2- 在 route_Handler&#x2F;artcateHandler.js 中写入更新文章分类的路由处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE-3"><span class="toc-number">22.4.6.3.</span> <span class="toc-text">3- 验证表单数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD-1"><span class="toc-number">22.4.6.4.</span> <span class="toc-text">4- 实现分类的功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-5-%E5%8F%91%E5%B8%83%E6%96%B0%E6%96%87%E7%AB%A0"><span class="toc-number">22.5.</span> <span class="toc-text">22.5 发布新文章</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-1-%E6%96%B0%E5%BB%BAev-articles%E8%A1%A8"><span class="toc-number">22.5.1.</span> <span class="toc-text">22.5.1 新建ev_articles表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-2-%E5%88%9D%E5%A7%8B%E5%8C%96%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">22.5.2.</span> <span class="toc-text">22.5.2 初始化路由模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%B0%E5%BB%BA-router-articleRoute-js-%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E7%9A%84%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">22.5.2.1.</span> <span class="toc-text">1- 新建 router&#x2F;articleRoute.js 发布文章的路由模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%B0%E5%BB%BA-router-Handler-articleHandler-js-%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">22.5.2.2.</span> <span class="toc-text">2- 新建 router_Handler&#x2F;articleHandler.js 发布文章的路由处理函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9C%A8-app-js-%E5%AF%BC%E5%85%A5%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%AF%B9%E8%B1%A1%E5%B9%B6%E6%B3%A8%E5%86%8C"><span class="toc-number">22.5.2.3.</span> <span class="toc-text">3- 在 app.js 导入路由处理对象并注册</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-3-%E4%BD%BF%E7%94%A8-multer-%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">22.5.3.</span> <span class="toc-text">22.5.3 使用 multer 解析表单数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85-multer-%E5%AF%BC%E5%85%A5%E8%A7%A3%E6%9E%90-formdata-%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8C%85"><span class="toc-number">22.5.3.1.</span> <span class="toc-text">1- 安装 multer 导入解析 formdata 数据的包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">22.5.3.2.</span> <span class="toc-text">2- 修改发布文章的路由</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-4-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">22.5.4.</span> <span class="toc-text">22.5.4 验证表单数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA-schema-articleSchema-js-%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E6%A8%A1%E5%9D%97%EF%BC%8C%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A6%82%E4%B8%8B%E7%9A%84%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="toc-number">22.5.4.1.</span> <span class="toc-text">1-创建 &#x2F;schema&#x2F;articleSchema.js 验证规则模块，并初始化如下的代码结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8-router-articleRouter-js-%E6%A8%A1%E5%9D%97%E4%B8%AD%EF%BC%8C%E5%AF%BC%E5%85%A5%E9%9C%80%E8%A6%81%E7%9A%84%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%B9%B6%E5%9C%A8%E8%B7%AF%E7%94%B1%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">22.5.4.2.</span> <span class="toc-text">2- 在 &#x2F;router&#x2F;articleRouter.js 模块中，导入需要的验证规则对象，并在路由中使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9C%A8-router-handler-articleHandler-js-%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E4%B8%AD%EF%BC%8C%E9%80%9A%E8%BF%87-if-%E5%88%A4%E6%96%AD%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E5%90%A6%E6%8F%90%E4%BA%A4%E4%BA%86-%E5%B0%81%E9%9D%A2%E5%9B%BE%E7%89%87"><span class="toc-number">22.5.4.3.</span> <span class="toc-text">3- 在 &#x2F;router_handler&#x2F;articleHandler.js 模块中的路由处理函数中，通过 if 判断客户端是否提交了 封面图片</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-5-%E5%AE%9E%E7%8E%B0%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">22.5.5.</span> <span class="toc-text">22.5.5 实现发布文章的功能</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/elementuiForm.html/" title="element ui  form表单校验"><img data-lazy-src="https://i.loli.net/2020/12/10/elQ1iKgjX8SUpo3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="element ui  form表单校验"/></a><div class="content"><a class="title" href="/posts/elementuiForm.html/" title="element ui  form表单校验">element ui  form表单校验</a><time datetime="2021-05-23T16:00:00.000Z" title="发表于 2021-05-24 00:00:00">2021-05-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/mianshi.html/" title="面试汇总"><img data-lazy-src="https://i.loli.net/2020/12/10/OgzWZnrSN4CDEQ3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试汇总"/></a><div class="content"><a class="title" href="/posts/mianshi.html/" title="面试汇总">面试汇总</a><time datetime="2021-05-23T16:00:00.000Z" title="发表于 2021-05-24 00:00:00">2021-05-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/elementuizzbd.html/" title="element ui 使用正则表达式进行校验 表单数据"><img data-lazy-src="https://i.loli.net/2020/12/10/6U2CcwkzxjRtrNV.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="element ui 使用正则表达式进行校验 表单数据"/></a><div class="content"><a class="title" href="/posts/elementuizzbd.html/" title="element ui 使用正则表达式进行校验 表单数据">element ui 使用正则表达式进行校验 表单数据</a><time datetime="2021-05-19T07:42:00.000Z" title="发表于 2021-05-19 15:42:00">2021-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/vue.html/" title="Vue"><img data-lazy-src="https://i.loli.net/2020/12/10/q5t8PKT61vU3pXo.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue"/></a><div class="content"><a class="title" href="/posts/vue.html/" title="Vue">Vue</a><time datetime="2021-05-12T09:57:50.000Z" title="发表于 2021-05-12 17:57:50">2021-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/flex.html/" title="flex 布局"><img data-lazy-src="https://i.loli.net/2020/12/10/7beIxPNwMtKLFVu.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="flex 布局"/></a><div class="content"><a class="title" href="/posts/flex.html/" title="flex 布局">flex 布局</a><time datetime="2021-05-05T04:57:50.000Z" title="发表于 2021-05-05 12:57:50">2021-05-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/12/10/PxUtYv75oglSq8D.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Ananiu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '8WBd1VRx82QjqeWssBiWlddO-MdYXbMMI',
      appKey: 'PncI8zh8LauUoICWEw5zuOIF',
      placeholder: '建议使用QQ邮箱，评论头像采用QQ头像',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false,
      master:'79b0957100e2dd6a073c9edbf622236e',
      tagMeta:["博主","小伙伴","访客"]，
      friends:'c14ab41f23416f072a790ffbd444c224,f73c98404a448c27c9ffa811e0f3c276,dfb91aa068cc95505677a4f0c7d8dde1',
  
      //- emojiMaps: {
      //-       "001":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/001.png",
      //-       "002":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/002.png",
      //-       "003":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/003.png",
      //-       "004":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/004.png",
      //-       "005":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/005.png",
      //-       "006":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/006.png",
      //-       "007":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/007.png",
      //-       "008":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/008.png",
      //-       "009":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/009.png",
      //-       "010":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/010.png",
      //-       "011":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/011.png",
      //-       "012":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/012.png",
      //-       "013":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/013.png",
      //-       "014":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/014.png",
      //-       "015":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/015.png",
      //-       "016":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/016.png",
      //-       "017":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/017.png",
      //-       "018":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/018.png",
      //-       "019":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/019.png",
      //-       "020":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/020.png",
      //-       "021":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/021.png",
      //-       "022":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/022.png",
      //-       "023":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/023.png",
      //-       "024":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/024.png",
      //-       "025":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/025.png",
      //-       "026":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/026.png",
      //-       "027":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/027.png",
      //-       "028":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/028.png",
      //-       "029":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/029.png",
      //-       "030":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/030.png",
      //-       "031":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/031.png",
      //-       "032":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/032.png",
      //-       "033":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/033.png",
      //-       "034":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/034.png",
      //-       "035":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/035.png",
      //-       "036":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/036.png",
      //-       "037":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/037.png",
      //-       "038":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/038.png",
      //-       "039":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/039.png",
      //-       "040":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/040.png",
      //-       "041":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/041.png",
      //-       "042":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/042.png",
      //-       "043":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/043.png",
      //-       "044":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/044.png",
      //-       "045":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/045.png",
      //-       "046":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/046.png",
      //-       "047":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/047.png",
      //-       "048":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/048.png",
      //-       "049":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/049.png",
      //-       "050":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/050.png",
      //-       "051":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/051.png",
      //-       "052":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/052.png",
      //-       "053":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/053.png",
      //-       "054":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/054.png",
      //-       "055":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/055.png",
      //-       "056":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/056.png",
      //-       "057":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/057.png",
      //-       "058":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/058.png",
      //-       "059":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/059.png",
      //-       "060":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/060.png",
      //-       "061":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/061.png",
      //-       "062":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/062.png",
      //-       "063":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/063.png",
      //-       "064":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/064.png",
      //-       "065":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/065.png",
      //-       "066":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/066.png",
      //-       "067":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/067.png",
      //-       "068":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/068.png",
      //-       "069":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/069.png",
      //-       "070":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/070.png",
      //-       "071":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/071.png",
      //-       "072":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/072.png",
      //-       "073":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/073.png",
      //-       "074":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/074.png",
      //-       "075":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/075.png",
      //-       "076":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/076.png",
      //-       "077":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/077.png",
      //-       "078":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/078.png",
      //-       "079":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/079.png",
      //-       "080":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/080.png",
      //-       "081":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/081.png",
      //-       "082":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/082.png",
      //-       "083":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/083.png",
      //-       "084":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/084.png",
      //-       "085":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/085.png",
      //-       "086":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/086.png",
      //-       "087":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/087.png",
      //-       "088":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/088.png",
      //-       "089":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/089.png",
      //-       "090":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/090.png",
      //-       "091":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/091.png",
      //-       "092":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/092.png",
      //-       "093":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/093.png",
      //-       "094":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/094.png",
      //-       "095":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/095.png",
      //-       "096":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/096.png",
      //-       "097":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/097.png",
      //-       "098":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/098.png",
      //-       "099":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/099.png",
      //-       "100":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/100.png",
      //-       "101":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/101.png",
      //-       "102":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/102.png",
      //-       "103":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/103.png",
      //-       "104":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/104.png",
      //-       "105":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/105.png",
      //-       "106":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/105.gif",
      //-       "1":"https://cdn.jsdelivr.net/gh/lete114/CDN/emoji/1.gif"
      //-  },
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/gh/lete114/CDN2/js/Valine-Lete3.2.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/gh/xiaopengand/blogCdn@latest/fishes.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script><!-- hexo injector body_end end --></body></html>